<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="reveal.js/dist/reset.css">
		<link rel="stylesheet" href="reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="reveal.js/dist/theme/serif.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css">
		<link rel="stylesheet" href="Agda.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
    <div hidden>
      \(
        \def\N{\mathbb{N}}
        \def\B{\mathbb{B}}
        \def\nat{\texttt{nat}}
        \def\bool{\texttt{bool}}
        \definecolor{deemph}{RGB}{75,75,75}
        \definecolor{bbb}{RGB}{0,100,255}
        \def\colortype#1{{\color{Blue}#1}}
        \def\colorterm#1{{\color{deemph}#1}}
        \def\importantcolortype#1{{\color{bbb}#1}}

        \def\lam#1#2{\lambda#1. #2}
        \def\app#1#2{#1\,#2}
        \def\hastype#1#2#3{\colortype{#1} \vdash \colorterm{#2} : \colortype{#3}}
      \)
    </div>
		<div class="reveal">
			<div class="slides">
				<section>
          <h2>Gradual algebraic effects</h2>
          <h3>formalized in Agda</h3>
          <div style="text-align:right;">
            <div><b>Li-yao Xia</b></div>
            <div>Philip Wadler</div>
          </div>
        </section>

        <section>
				  <section>Algebraic effects</section>
          <section>handler = fold</section>
        </section>

        <section>
				  <section>Gradual types</section>
          <section>
            <div class="footnote">Siek and Taha (2006)</div>
            <div style="text-align:left;">Gradual type system</div>
            \[\begin{prooftree}
                \AxiomC{\(\hastype{\Gamma}{N}{A' \to B}\)}
                \AxiomC{\(\hastype{\Gamma}{M}{A}\)}
                \AxiomC{\(\importantcolortype{A' \sim A}\)}
              \TrinaryInfC{\(\hastype{\Gamma}{\app{N}{M}}{B}\)}
            \end{prooftree}\]

            \[\begin{prooftree}
                \AxiomC{\(\hastype{\Gamma}{N}{\importantcolortype{\star}}\)}
                \AxiomC{\(\hastype{\Gamma}{M}{A}\)}
              \BinaryInfC{\(\hastype{\Gamma}{\app{N}{M}}{\importantcolortype{\star}}\)}
            \end{prooftree}\]

            <div style="text-align:left;">Type consistency \(A \sim B\)</div>
            \[
            \begin{prooftree}
                \AxiomC{}
              \UnaryInfC{\(\colortype{A \sim \star}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
                \AxiomC{}
              \UnaryInfC{\(\colortype{\star \sim A}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
                \AxiomC{\(\colortype{A \sim A'}\)}
                \AxiomC{\(\colortype{B \sim B'}\)}
              \BinaryInfC{\(\colortype{A \to B \sim A' \to B'}\)}
            \end{prooftree}
            \]
          </section>
          <section>
            <div style="text-align:left;">Why not this?</div>
            \[\begin{prooftree}
                \AxiomC{\(\hastype{\Gamma}{M}{A}\)}
                \AxiomC{\(\colortype{A \sim B}\)}
              \BinaryInfC{\(\hastype{\Gamma}{M}{B}\)}
            \end{prooftree}\]

            <div style="text-align:left;">Cast between all types:</div>
            \[\begin{prooftree}
                  \AxiomC{\(\hastype{\Gamma}{M}{A}\)}
                  \AxiomC{\(\colortype{A \sim \star}\)}
                \BinaryInfC{\(\hastype{\Gamma}{M}{\star}\)}
                \AxiomC{\(\colortype{\star \sim B}\)}
              \BinaryInfC{\(\hastype{\Gamma}{M}{B}\)}
            \end{prooftree}\]
            <div style="text-align:left; font-size:35px;">NB: \(\sim\) not transitive! \(\implies\) subsumption rule = bad idea</div>
          </section>
        </section>

        <section>
          \[\begin{prooftree}
              \AxiomC{\(\hastype{\Gamma,x:A}{M}{B}\)}
            \UnaryInfC{\(\hastype{\Gamma}{\lam{x}{M}}{A \to B}\)}
          \end{prooftree}\]
        </section>
        <section>
          \[\begin{prooftree}
              \AxiomC{\(\hastype{\Gamma}{N}{A\to B}\)}
              \AxiomC{\(\hastype{\Gamma}{M}{A}\)}
            \BinaryInfC{\(\hastype{\Gamma}{\app{N}{M}}{B}\)}
          \end{prooftree}\]
        </section>
        <section>
          \[\begin{prooftree}
                  \AxiomC{}
                  \RightLabel{Tag \(\nat\)}
                \UnaryInfC{\(\nat \le \star\)}
                  \AxiomC{}
                  \RightLabel{Tag \(\bool\)}
                \UnaryInfC{\(\bool \le \star\)}
              \BinaryInfC{\((\nat \to \bool) \le (\star \to \star)\)}
              \RightLabel{Tag \((\star \to \star)\)}
            \UnaryInfC{\((\nat \to \bool) \le \star\)}
          \end{prooftree}\]
        </section>
        <section>
          <p>Some code</p>
          <code>
            
<pre class="Agda"><a id="116" class="Keyword">import</a> <a id="123" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="137" class="Keyword">open</a> <a id="142" class="Keyword">import</a> <a id="149" href="Utils.html" class="Module">Utils</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Type.html" class="Module">Type</a>
<a id="172" class="Keyword">open</a> <a id="177" class="Keyword">import</a> <a id="184" href="Core.html" class="Module">Core</a>
<a id="189" class="Keyword">open</a> <a id="194" class="Keyword">import</a> <a id="201" href="Prec.html" class="Module">Prec</a> <a id="206" class="Keyword">hiding</a> <a id="213" class="Symbol">(</a><a id="214" href="Prec.html#15903" class="InductiveConstructor">cast≤</a><a id="219" class="Symbol">)</a>

<a id="222" class="Keyword">data</a> <a id="_⊢¹_"></a><a id="227" href="Code.html#227" class="Datatype Operator">_⊢¹_</a> <a id="232" class="Symbol">(</a><a id="233" href="Code.html#233" class="Bound">ℰ</a> <a id="235" class="Symbol">:</a> <a id="237" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="240" class="Symbol">)</a> <a id="242" class="Symbol">:</a> <a id="244" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="248" class="Keyword">where</a>
</pre>
          </code>
        </section>
        <section>
          \[\begin{CD}
           A @<<< C
           @VVV   @.
           B @.
          \end{CD}
          \]
        </section>
        <section>
          <style>
            .container { display: flex; align-items: center; }
            .col-1 { flex: 2; } .col-2 { flex: 1; }
          </style>
          <div class="container">
            <code class="col-1 tiny">
<pre class="Agda">  <a id="A.cast⁺≤"></a><a id="482" href="Code.html#482" class="Function">cast⁺≤</a> <a id="489" class="Symbol">:</a> <a id="491" class="Symbol">{</a><a id="492" href="Code.html#492" class="Bound">p</a> <a id="494" class="Symbol">:</a> <a id="496" href="Code.html#312" class="Generalizable">P</a> <a id="498" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="501" href="Code.html#317" class="Generalizable">Q</a><a id="502" class="Symbol">}</a> <a id="504" class="Symbol">{</a><a id="505" href="Code.html#505" class="Bound">q</a> <a id="507" class="Symbol">:</a> <a id="509" href="Code.html#317" class="Generalizable">Q</a> <a id="511" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="514" href="Code.html#319" class="Generalizable">R</a><a id="515" class="Symbol">}</a> <a id="517" class="Symbol">{</a><a id="518" href="Code.html#518" class="Bound">r</a> <a id="520" class="Symbol">:</a> <a id="522" href="Code.html#312" class="Generalizable">P</a> <a id="524" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="527" href="Code.html#319" class="Generalizable">R</a><a id="528" class="Symbol">}</a>
    <a id="534" class="Symbol">→</a>  <a id="537" href="Code.html#492" class="Bound">p</a> <a id="539" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="542" href="Code.html#505" class="Bound">q</a> <a id="544" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="546" href="Code.html#518" class="Bound">r</a>       <a id="554" class="Comment">-- ← commutative triangle</a>
    <a id="584" class="Symbol">→</a>  <a id="587" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="590" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="592" href="Code.html#363" class="Generalizable">M</a> <a id="594" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="597" href="Code.html#375" class="Generalizable">M′</a> <a id="600" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="602" href="Code.html#518" class="Bound">r</a>
       <a id="611" class="Comment">---------------------------</a>
    <a id="643" class="Symbol">→</a>  <a id="646" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="649" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="651" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="656" class="Symbol">(</a><a id="657" href="Type.html#15331" class="InductiveConstructor Operator">+</a> <a id="659" href="Code.html#492" class="Bound">p</a><a id="660" class="Symbol">)</a> <a id="662" href="Code.html#363" class="Generalizable">M</a> <a id="664" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="667" href="Code.html#375" class="Generalizable">M′</a> <a id="670" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="672" href="Code.html#505" class="Bound">q</a>
</pre></code>
            <img class="col-2" src="cast-left-plus-tex.svg" width="250" height="250"/>
          </div>
          <div class="container">
            <code class="col-1 tiny">
<pre class="Agda">  <a id="A.cast⁻≤"></a><a id="753" href="Code.html#753" class="Function">cast⁻≤</a> <a id="760" class="Symbol">:</a> <a id="762" class="Symbol">{</a><a id="763" href="Code.html#763" class="Bound">p</a> <a id="765" class="Symbol">:</a> <a id="767" href="Code.html#317" class="Generalizable">Q</a> <a id="769" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="772" href="Code.html#312" class="Generalizable">P</a><a id="773" class="Symbol">}</a> <a id="775" class="Symbol">{</a><a id="776" href="Code.html#776" class="Bound">q</a> <a id="778" class="Symbol">:</a> <a id="780" href="Code.html#317" class="Generalizable">Q</a> <a id="782" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="785" href="Code.html#319" class="Generalizable">R</a><a id="786" class="Symbol">}</a> <a id="788" class="Symbol">{</a><a id="789" href="Code.html#789" class="Bound">r</a> <a id="791" class="Symbol">:</a> <a id="793" href="Code.html#312" class="Generalizable">P</a> <a id="795" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="798" href="Code.html#319" class="Generalizable">R</a><a id="799" class="Symbol">}</a>
    <a id="805" class="Symbol">→</a>  <a id="808" href="Code.html#763" class="Bound">p</a> <a id="810" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="813" href="Code.html#789" class="Bound">r</a> <a id="815" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="817" href="Code.html#776" class="Bound">q</a>       <a id="825" class="Comment">-- ← commutative triangle</a>
    <a id="855" class="Symbol">→</a>  <a id="858" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="861" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="863" href="Code.html#363" class="Generalizable">M</a> <a id="865" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="868" href="Code.html#375" class="Generalizable">M′</a> <a id="871" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="873" href="Code.html#789" class="Bound">r</a>
       <a id="882" class="Comment">--------------------------</a>
    <a id="913" class="Symbol">→</a>  <a id="916" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="919" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="921" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="926" class="Symbol">(</a><a id="927" href="Type.html#15389" class="InductiveConstructor Operator">-</a> <a id="929" href="Code.html#763" class="Bound">p</a><a id="930" class="Symbol">)</a> <a id="932" href="Code.html#363" class="Generalizable">M</a> <a id="934" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="937" href="Code.html#375" class="Generalizable">M′</a> <a id="940" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="942" href="Code.html#776" class="Bound">q</a>
</pre></code>
            <img class="col-2" src="cast-left-minus-tex.svg" width="250" height="250"/>
          </div>
        </section>
        <section>
          <style>
            .container { display: flex; align-items: center; }
            .col-1 { flex: 2; } .col-2 { flex: 1; }
          </style>
          <div class="container">
            <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁺≤"></a><a id="1048" href="Code.html#1048" class="Function">cast⁺≤</a> <a id="1055" class="Symbol">:</a> <a id="1057" class="Symbol">{</a><a id="1058" href="Code.html#1058" class="Bound">P≤Q</a> <a id="1062" class="Symbol">:</a> <a id="1064" href="Code.html#312" class="Generalizable">P</a> <a id="1066" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1069" href="Code.html#317" class="Generalizable">Q</a><a id="1070" class="Symbol">}</a> <a id="1072" class="Symbol">{</a><a id="1073" href="Code.html#1073" class="Bound">Q≤R</a> <a id="1077" class="Symbol">:</a> <a id="1079" href="Code.html#317" class="Generalizable">Q</a> <a id="1081" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1084" href="Code.html#319" class="Generalizable">R</a><a id="1085" class="Symbol">}</a> <a id="1087" class="Symbol">{</a><a id="1088" href="Code.html#1088" class="Bound">P≤R</a> <a id="1092" class="Symbol">:</a> <a id="1094" href="Code.html#312" class="Generalizable">P</a> <a id="1096" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1099" href="Code.html#319" class="Generalizable">R</a><a id="1100" class="Symbol">}</a>
    <a id="1106" class="Symbol">→</a>  <a id="1109" href="Code.html#1058" class="Bound">P≤Q</a> <a id="1113" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="1116" href="Code.html#1073" class="Bound">Q≤R</a> <a id="1120" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1122" href="Code.html#1088" class="Bound">P≤R</a>       <a id="1132" class="Comment">-- ← commutative triangle</a>
    <a id="1162" class="Symbol">→</a>  <a id="1165" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="1168" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="1170" href="Code.html#363" class="Generalizable">M</a> <a id="1172" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="1175" href="Code.html#375" class="Generalizable">M′</a> <a id="1178" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="1180" href="Code.html#1088" class="Bound">P≤R</a>
       <a id="1191" class="Comment">-------------------------------</a>
    <a id="1227" class="Symbol">→</a>  <a id="1230" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="1233" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="1235" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="1240" class="Symbol">(</a><a id="1241" href="Type.html#15331" class="InductiveConstructor Operator">+</a> <a id="1243" href="Code.html#1058" class="Bound">P≤Q</a><a id="1246" class="Symbol">)</a> <a id="1248" href="Code.html#363" class="Generalizable">M</a> <a id="1250" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="1253" href="Code.html#375" class="Generalizable">M′</a> <a id="1256" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="1258" href="Code.html#1073" class="Bound">Q≤R</a>
</pre></code>
            <img class="col-2" src="cast-left-plus-tex.svg" width="250" height="250"/>
          </div>
          <div class="container">
            <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁻≤"></a><a id="1343" href="Code.html#1343" class="Function">cast⁻≤</a> <a id="1350" class="Symbol">:</a> <a id="1352" class="Symbol">{</a><a id="1353" href="Code.html#1353" class="Bound">Q≤P</a> <a id="1357" class="Symbol">:</a> <a id="1359" href="Code.html#317" class="Generalizable">Q</a> <a id="1361" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1364" href="Code.html#312" class="Generalizable">P</a><a id="1365" class="Symbol">}</a> <a id="1367" class="Symbol">{</a><a id="1368" href="Code.html#1368" class="Bound">Q≤R</a> <a id="1372" class="Symbol">:</a> <a id="1374" href="Code.html#317" class="Generalizable">Q</a> <a id="1376" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1379" href="Code.html#319" class="Generalizable">R</a><a id="1380" class="Symbol">}</a> <a id="1382" class="Symbol">{</a><a id="1383" href="Code.html#1383" class="Bound">P≤R</a> <a id="1387" class="Symbol">:</a> <a id="1389" href="Code.html#312" class="Generalizable">P</a> <a id="1391" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="1394" href="Code.html#319" class="Generalizable">R</a><a id="1395" class="Symbol">}</a>
    <a id="1401" class="Symbol">→</a>  <a id="1404" href="Code.html#1353" class="Bound">Q≤P</a> <a id="1408" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="1411" href="Code.html#1383" class="Bound">P≤R</a> <a id="1415" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1417" href="Code.html#1368" class="Bound">Q≤R</a>       <a id="1427" class="Comment">-- ← commutative triangle</a>
    <a id="1457" class="Symbol">→</a>  <a id="1460" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="1463" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="1465" href="Code.html#363" class="Generalizable">M</a> <a id="1467" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="1470" href="Code.html#375" class="Generalizable">M′</a> <a id="1473" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="1475" href="Code.html#1383" class="Bound">P≤R</a>
       <a id="1486" class="Comment">-------------------------------</a>
    <a id="1522" class="Symbol">→</a>  <a id="1525" href="Code.html#348" class="Generalizable">Γ≤</a> <a id="1528" href="Prec.html#11628" class="Datatype Operator">⊢</a> <a id="1530" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="1535" class="Symbol">(</a><a id="1536" href="Type.html#15389" class="InductiveConstructor Operator">-</a> <a id="1538" href="Code.html#1353" class="Bound">Q≤P</a><a id="1541" class="Symbol">)</a> <a id="1543" href="Code.html#363" class="Generalizable">M</a> <a id="1545" href="Prec.html#11628" class="Datatype Operator">≤ᴹ</a> <a id="1548" href="Code.html#375" class="Generalizable">M′</a> <a id="1551" href="Prec.html#11628" class="Datatype Operator">⦂</a> <a id="1553" href="Code.html#1368" class="Bound">Q≤R</a>
</pre></code>
            <img class="col-2" src="cast-left-minus-tex.svg" width="250" height="250"/>
          </div>
        </section>
			</div>
		</div>

		<script src="reveal.js/dist/reveal.js"></script>
		<script src="reveal.js/plugin/notes/notes.js"></script>
		<script src="reveal.js/plugin/markdown/markdown.js"></script>
		<script src="reveal.js/plugin/highlight/highlight.js"></script>
    <script src="reveal.js/plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
        slideNumber: 'c',
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.MathJax3 ],
        mathjax3: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          tex: {
            inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ]  ]
          },
          options: {
            skipHtmlTags: [ 'script', 'noscript', 'style', 'textarea', 'pre' ]
          },
        }
			});
		</script>
	</body>
</html>