<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Gradual algebraic effects</title>

		<link rel="stylesheet" href="reveal.js/dist/reset.css">
		<link rel="stylesheet" href="reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="reveal.js/dist/theme/serif.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="reveal.js/plugin/highlight/default.css">
		<link rel="stylesheet" href="Agda.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
    <div hidden>
      \(
        \def\N{\mathbb{N}}
        \def\B{\mathbb{B}}
        \def\nat{\N}
        \def\bool{\B}
        \definecolor{deemph}{RGB}{75,75,75}
        \definecolor{bbb}{RGB}{0,100,255}
        \def\typecolor#1{{\color{Blue}#1}}
        \def\termcolor#1{{\color{deemph}#1}}
        \def\castcolor#1{{\color{RedOrange}#1}}
        \def\importanttypecolor#1{{\color{bbb}#1}}
        \def\precision#1#2{{\color{Blue}#1 \color{Green} \le \color{Blue} #2}}

        \def\lam#1#2{\lambda#1. #2}
        \def\app#1#2{#1\,#2}
        \def\castof#1{\texttt{cast}^{#1}}
        \def\hastype#1#2#3{\typecolor{#1} \vdash \termcolor{#2} : \typecolor{#3}}
      \)
    </div>
		<div class="reveal">
			<div class="slides">
				<section>
          <h2>Gradual algebraic effects</h2>
          <h3>formalized in Agda</h3>
          <div style="text-align:right;">
            <div><b>Li-yao Xia</b></div>
            <div>Philip Wadler</div>
          </div>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            <div class="flexbox">
              <div style="color: white;">Dynamic</div>
              <div class="flex-1"></div>
              <div>Static</div>
            </div>
            <div style="height: 150px;"></div>
            <h3 class="height-half">Gradual types</h3>
            <div style="height: 150px;"></div>
          </section>
          <section>
            <div class="flexbox">
              <div class="flex-1">
<div>Library</div>
<div class="gradual-box"><div class="gradual-label right">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
write_to_db(row : Any) : Any
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="1"><div class="gradual-label right">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
write_to_db(row : N × N) : ()
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="2"><div class="gradual-label right">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
write_to_db(row : Any) : Any
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="0"><div class="gradual-label right">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
write_to_db(row : N × N) : ()
 
</code></pre>
</div>
              </div>
              <div class="flex-1">
<div>Application</div>
<div class="gradual-box"><div class="gradual-label left">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
get_data() : Any
write_to_db(get_data()) : Any
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="1"><div class="gradual-label left">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
get_data() : Any
write_to_db(get_data()) : Any
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="2"><div class="gradual-label left">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
get_data() : N × N
write_to_db(get_data()) : ()
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="0"><div class="gradual-label left">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
get_data() : N × N
write_to_db(get_data()) : ()
</code></pre>
</div>
              </div>
            </div>
            <div>Well-typed throughout gradual migration</div>
          </section>
          <section>
            <blockquote class="medium-small">
            But languages with dynamic typing also have a flexibility which is hard to emulate with a static type system.
            <br>— <a href="https://kar.kent.ac.uk/88959/1/history.pdf_nocoversheet">Turner (2012)</a>
            </blockquote>
            <div>When static types go ¯\_(ツ)_/¯</div>
            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto : nat -> ★ -> bool
tauto 0 b = b
tauto n f = tauto (n-1) (f false) && tauto (n-1) (f true)
            </code></pre>
            </div>

            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto n f = true   iff   ∀ x1 ... xn, f x1 ... xn = true 
            </code></pre>
            </div>
            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto 1 :                 (bool -> bool) -> bool
tauto 2 :         (bool -> bool -> bool) -> bool
tauto 3 : (bool -> bool -> bool -> bool) -> bool
            </code></pre>
            </div>
          </section>
          <section>
            <div>Anatomy of a gradually typed language</div>
            <ul style="list-style: none;">
              <li class="fragment"><b>Dynamic type</b> "\(\star\)" (aka. <code>Any</code>)</li>
              <li class="fragment margin-top-10"><b>Surface language:</b> \(f : \nat \to \bool, x : \star \vdash \app{f}{x} : \bool\)</li>
              <li class="fragment">⮩ Some flexibility, but not too loose either</li>
              <li class="fragment margin-top-10">Core language = <b>cast calculus:</b> \(f : \nat \to \bool, x : \star \vdash \app{f}{(\castof{-p}\,x)} : \bool\)</li>
              <li class="fragment">⮩ Operational semantics</li>
              <li class="fragment">⮩ <b>Gradual guarantee:</b> how code should behave when type annotations
                are added incrementally.</li>
            </ul>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            Surface language: a gradual type system
          </section>

          <section>
            <div class="left">Precision \(\precision{A}{B}\)</div>
            \[\begin{prooftree}
              \AxiomC{\(\precision{A}{\star}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
              \AxiomC{\(\precision{A}{A}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
                \AxiomC{\(\precision{A}{A'}\)}
                \AxiomC{\(\precision{B}{B'}\)}
              \BinaryInfC{\(\precision{A \to B}{A' \to B'}\)}
            \end{prooftree}
            \]
            <div class="fragment">Covariant in the domain!</div>
            <div class="fragment">Precision aka. "Naive Subtyping"</div>
            <div class="left fragment margin-top-10">
            <div>Gradual type system</div>
            \[\begin{prooftree}
                \AxiomC{\(\precision{A}{B}\)}
                \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
              \BinaryInfC{\(\hastype{\Gamma}{M}{A}\)}
            \end{prooftree}\]
            </div>
          </section>
          <section>
            <div>Precision relation <code>A ≤ B</code></div>
          <code class="big">
            
<pre class="Agda">    <a id="346" class="Keyword">data</a> <a id="T.Fake._≤_"></a><a id="351" href="Code.html#351" class="Datatype Operator">_≤_</a> <a id="355" class="Symbol">:</a> <a id="357" href="Code.html#172" class="Datatype">Type</a> <a id="362" class="Symbol">→</a> <a id="364" href="Code.html#172" class="Datatype">Type</a> <a id="369" class="Symbol">→</a> <a id="371" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="375" class="Keyword">where</a>

      <a id="T.Fake._≤_.≤★"></a><a id="388" href="Code.html#388" class="InductiveConstructor">≤★</a> <a id="391" class="Symbol">:</a>
          <a id="403" class="Comment">-----</a>
          <a id="419" href="Code.html#269" class="Generalizable">A</a> <a id="421" href="Code.html#351" class="Datatype Operator">≤</a> <a id="423" href="Code.html#193" class="InductiveConstructor">★</a>

      <a id="T.Fake._≤_.id"></a><a id="432" href="Code.html#432" class="InductiveConstructor">id</a> <a id="435" class="Symbol">:</a>
          <a id="447" class="Comment">-----</a>
          <a id="463" href="Code.html#269" class="Generalizable">A</a> <a id="465" href="Code.html#351" class="Datatype Operator">≤</a> <a id="467" href="Code.html#269" class="Generalizable">A</a>

      <a id="T.Fake._≤_._⇒_"></a><a id="476" href="Code.html#476" class="InductiveConstructor Operator">_⇒_</a> <a id="480" class="Symbol">:</a>
          <a id="492" href="Code.html#269" class="Generalizable">A</a> <a id="494" href="Code.html#351" class="Datatype Operator">≤</a> <a id="496" href="Code.html#271" class="Generalizable">A′</a>
        <a id="507" class="Symbol">→</a> <a id="509" href="Code.html#274" class="Generalizable">B</a> <a id="511" href="Code.html#351" class="Datatype Operator">≤</a> <a id="513" href="Code.html#276" class="Generalizable">B′</a>
          <a id="526" class="Comment">-------------------</a>
        <a id="554" class="Symbol">→</a> <a id="556" class="Symbol">(</a><a id="557" href="Code.html#269" class="Generalizable">A</a> <a id="559" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="561" href="Code.html#274" class="Generalizable">B</a><a id="562" class="Symbol">)</a> <a id="564" href="Code.html#351" class="Datatype Operator">≤</a> <a id="566" class="Symbol">(</a><a id="567" href="Code.html#271" class="Generalizable">A′</a> <a id="570" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="572" href="Code.html#276" class="Generalizable">B′</a><a id="574" class="Symbol">)</a>
</pre>
          </code>
          </section>
          <section>
            <div>Well-typed terms <code>Γ ⊢ M ⦂ A</code></div>
          <code class="big">
            
<pre class="Agda">    <a id="1286" class="Keyword">data</a> <a id="T.W._⊢_⦂_"></a><a id="1291" href="Code.html#1291" class="Datatype Operator">_⊢_⦂_</a> <a id="1297" class="Symbol">:</a> <a id="1299" href="Code.html#1070" class="Datatype">Context</a> <a id="1307" class="Symbol">→</a> <a id="1309" href="Code.html#1148" class="Datatype">Term</a> <a id="1314" class="Symbol">→</a> <a id="1316" href="Code.html#172" class="Datatype">Type</a> <a id="1321" class="Symbol">→</a> <a id="1323" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1327" class="Keyword">where</a>

      <a id="T.W._⊢_⦂_.materialize"></a><a id="1340" href="Code.html#1340" class="InductiveConstructor">materialize</a> <a id="1352" class="Symbol">:</a>
           <a id="1365" href="Code.html#269" class="Generalizable">A</a> <a id="1367" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1369" href="Code.html#274" class="Generalizable">B</a>
        <a id="1379" class="Symbol">→</a>  <a id="1382" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1384" href="Code.html#1291" class="Datatype Operator">⊢</a> <a id="1386" href="Code.html#1205" class="Generalizable">M</a> <a id="1388" href="Code.html#1291" class="Datatype Operator">⦂</a> <a id="1390" href="Code.html#274" class="Generalizable">B</a>
           <a id="1403" class="Comment">---------</a>
        <a id="1421" class="Symbol">→</a>  <a id="1424" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1426" href="Code.html#1291" class="Datatype Operator">⊢</a> <a id="1428" href="Code.html#1205" class="Generalizable">M</a> <a id="1430" href="Code.html#1291" class="Datatype Operator">⦂</a> <a id="1432" href="Code.html#269" class="Generalizable">A</a>

      <a id="1441" class="Comment">-- etc.</a>
</pre>
          </code>
          </section>
          <section>
            <div>Example derivation</div>
            <div class="left">
              \(\termcolor{f} : \typecolor{\star \to \star}\)
              <br>\(\termcolor{x} : \typecolor{\nat}\)
              <br>\(\termcolor{\app{f}{x}} : \typecolor{\nat}\)
            </div>
            \[\begin{prooftree}
                    \AxiomC{\(\precision{\nat \to \nat}{\star \to \star}\)}
                    \AxiomC{\(\hastype{\Gamma}{f}{\star \to \star}\)}
                  \BinaryInfC{\(\hastype{\Gamma}{f}{\nat \to \nat}\)}
                  \AxiomC{\(\hastype{\Gamma}{x}{\nat}\)}
                \BinaryInfC{\(\hastype{\Gamma}{\app{f}{x}}{\nat}\)}
              \end{prooftree}
            \]
            <code class="fragment">
              

<pre class="Agda">    <a id="2841" class="Symbol">λ</a> <a id="2843" class="Symbol">(</a><a id="2844" href="Code.html#2844" class="Bound">f</a> <a id="2846" class="Symbol">:</a> <a id="2848" href="Code.html#2741" class="Bound">Γ</a> <a id="2850" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2852" href="Code.html#193" class="InductiveConstructor">★</a> <a id="2854" class="InductiveConstructor Operator">⇒</a> <a id="2856" href="Code.html#193" class="InductiveConstructor">★</a><a id="2857" class="Symbol">)</a>
      <a id="2865" class="Symbol">(</a><a id="2866" href="Code.html#2866" class="Bound">x</a> <a id="2868" class="Symbol">:</a> <a id="2870" href="Code.html#2741" class="Bound">Γ</a> <a id="2872" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2874" class="InductiveConstructor">′ℕ</a><a id="2876" class="Symbol">)</a> <a id="2878" class="Symbol">→</a> 
      <a id="2887" class="Comment">------------------------------------</a>
      <a id="2930" class="Symbol">(</a><a id="2931" href="Code.html#2753" class="Bound">materialize</a> <a id="2943" href="Code.html#2676" class="Function">ℕ⇒ℕ≤★⇒★</a> <a id="2951" href="Code.html#2844" class="Bound">f</a><a id="2952" class="Symbol">)</a> <a id="2954" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="2956" href="Code.html#2866" class="Bound">x</a>  <a id="2959" class="Comment">-- : ′ℕ</a>
</pre>

            </code>
          </section>
          <section>
            <div>Gradual typing as a superset of static typing</div>
            <div>
              <p class="medium">
              If \(M\) is static (all binders annotated with non-\(\star\) types), then
              </p>
              \[\vdash_{\mathrm{Gradual}} M : A \iff \vdash_{\mathrm{STLC}} M : A\]
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            <div>Towards an operational semantics</div>
            <div>Compilation to a cast calculus</div>
          </section>
          <section>
            <div class="left">Surface language:
              \[\begin{prooftree}
                  \AxiomC{\(\precision{A}{B}\)}
                  \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
                \BinaryInfC{\(\hastype{\Gamma}{M}{A}\)}
              \end{prooftree}\]
            </div>
            <div class="fragment left">Cast calculus:
              \[\begin{prooftree}
                  \AxiomC{\(\castcolor{p :}\precision{A}{B}\)}
                  \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
                \BinaryInfC{\(\hastype{\Gamma}{\castcolor{\castof{p}\,}M}{A}\)}
              \end{prooftree}\]
            </div>
          </section>
          <section>
            <div class="left">Surface:</div>
            <code>
              
<pre class="Agda">  <a id="1508" class="Keyword">data</a> <a id="T._⊢_⦂_"></a><a id="1513" href="Code.html#1513" class="Datatype Operator">_⊢_⦂_</a> <a id="1519" class="Symbol">:</a> <a id="1521" href="Code.html#1070" class="Datatype">Context</a> <a id="1529" class="Symbol">→</a> <a id="1531" href="Code.html#1148" class="Datatype">Term</a> <a id="1536" class="Symbol">→</a> <a id="1538" href="Code.html#172" class="Datatype">Type</a> <a id="1543" class="Symbol">→</a> <a id="1545" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1549" class="Keyword">where</a>

    <a id="T._⊢_⦂_.materialize"></a><a id="1560" href="Code.html#1560" class="InductiveConstructor">materialize</a> <a id="1572" class="Symbol">:</a>
         <a id="1583" class="Symbol">(</a><a id="1584" href="Code.html#1584" class="Bound">p</a> <a id="1586" class="Symbol">:</a> <a id="1588" href="Code.html#269" class="Generalizable">A</a> <a id="1590" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1592" href="Code.html#274" class="Generalizable">B</a><a id="1593" class="Symbol">)</a>
      <a id="1601" class="Symbol">→</a>  <a id="1604" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1606" href="Code.html#1513" class="Datatype Operator">⊢</a> <a id="1608" href="Code.html#1205" class="Generalizable">M</a> <a id="1610" href="Code.html#1513" class="Datatype Operator">⦂</a> <a id="1612" href="Code.html#274" class="Generalizable">B</a>
         <a id="1623" class="Comment">---------</a>
      <a id="1639" class="Symbol">→</a>  <a id="1642" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1644" href="Code.html#1513" class="Datatype Operator">⊢</a> <a id="1646" href="Code.html#1205" class="Generalizable">M</a> <a id="1648" href="Code.html#1513" class="Datatype Operator">⦂</a> <a id="1650" href="Code.html#269" class="Generalizable">A</a>

    <a id="1657" class="Comment">-- etc.</a>
</pre>
            </code>
            <div>The derivation already has the right structure.</div>
            <code class="fragment">
              
<pre class="Agda">    <a id="2841" class="Symbol">λ</a> <a id="2843" class="Symbol">(</a><a id="2844" href="Code.html#2844" class="Bound">f</a> <a id="2846" class="Symbol">:</a> <a id="2848" href="Code.html#2741" class="Bound">Γ</a> <a id="2850" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2852" href="Code.html#193" class="InductiveConstructor">★</a> <a id="2854" class="InductiveConstructor Operator">⇒</a> <a id="2856" href="Code.html#193" class="InductiveConstructor">★</a><a id="2857" class="Symbol">)</a>
      <a id="2865" class="Symbol">(</a><a id="2866" href="Code.html#2866" class="Bound">x</a> <a id="2868" class="Symbol">:</a> <a id="2870" href="Code.html#2741" class="Bound">Γ</a> <a id="2872" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2874" class="InductiveConstructor">′ℕ</a><a id="2876" class="Symbol">)</a> <a id="2878" class="Symbol">→</a> 
      <a id="2887" class="Comment">------------------------------------</a>
      <a id="2930" class="Symbol">(</a><a id="2931" href="Code.html#2753" class="Bound">materialize</a> <a id="2943" href="Code.html#2676" class="Function">ℕ⇒ℕ≤★⇒★</a> <a id="2951" href="Code.html#2844" class="Bound">f</a><a id="2952" class="Symbol">)</a> <a id="2954" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="2956" href="Code.html#2866" class="Bound">x</a>  <a id="2959" class="Comment">-- : ′ℕ</a>
</pre>
            </code>
          </section>
          <section>
            <div class="left">Cast calculus, intrinsically typed <code>M : Γ ⊢ A</code>:</div>
            <code>
              
<pre class="Agda">  <a id="2051" class="Keyword">data</a> <a id="T._⊢_"></a><a id="2056" href="Code.html#2056" class="Datatype Operator">_⊢_</a> <a id="2060" class="Symbol">:</a> <a id="2062" href="Code.html#1070" class="Datatype">Context</a> <a id="2070" class="Symbol">→</a> <a id="2072" href="Code.html#172" class="Datatype">Type</a> <a id="2077" class="Symbol">→</a> <a id="2079" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2083" class="Keyword">where</a>

    <a id="T._⊢_._·_"></a><a id="2094" href="Code.html#2094" class="InductiveConstructor Operator">_·_</a> <a id="2098" class="Symbol">:</a>
         <a id="2109" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2111" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2113" href="Code.html#269" class="Generalizable">A</a> <a id="2115" class="InductiveConstructor Operator">⇒</a> <a id="2117" href="Code.html#274" class="Generalizable">B</a>
      <a id="2125" class="Symbol">→</a>  <a id="2128" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2130" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2132" href="Code.html#269" class="Generalizable">A</a>
         <a id="2143" class="Comment">--------- application</a>
      <a id="2171" class="Symbol">→</a>  <a id="2174" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2176" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2178" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._⊢_.ƛ_"></a><a id="2185" href="Code.html#2185" class="InductiveConstructor Operator">ƛ_</a> <a id="2188" class="Symbol">:</a>
         <a id="2199" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2201" href="Code.html#1110" class="InductiveConstructor Operator">▷</a> <a id="2203" href="Code.html#269" class="Generalizable">A</a> <a id="2205" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2207" href="Code.html#274" class="Generalizable">B</a>
         <a id="2218" class="Comment">--------- abstraction</a>
      <a id="2246" class="Symbol">→</a>  <a id="2249" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2251" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2253" href="Code.html#269" class="Generalizable">A</a> <a id="2255" class="InductiveConstructor Operator">⇒</a> <a id="2257" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._⊢_.`_"></a><a id="2264" href="Code.html#2264" class="InductiveConstructor Operator">`_</a> <a id="2267" class="Symbol">:</a>
         <a id="2278" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2280" href="Code.html#1964" class="Datatype Operator">∋</a> <a id="2282" href="Code.html#269" class="Generalizable">A</a>
         <a id="2293" class="Comment">----- variable</a>
      <a id="2314" class="Symbol">→</a>  <a id="2317" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2319" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2321" href="Code.html#269" class="Generalizable">A</a>

    <a id="2328" class="Comment">-- etc.</a>
</pre>
            </code>
          </section>
          <section>
            <div class="left">Cast rule:</div>
            <code>
              
<pre class="Agda">    <a id="T._⊢_.cast"></a><a id="2385" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="2390" class="Symbol">:</a>
         <a id="2401" href="Code.html#269" class="Generalizable">A</a> <a id="2403" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="2406" href="Code.html#274" class="Generalizable">B</a>  <a id="2409" class="Comment">-- New cast construct</a>
      <a id="2437" class="Symbol">→</a>  <a id="2440" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2442" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2444" href="Code.html#269" class="Generalizable">A</a>
         <a id="2455" class="Comment">---------</a>
      <a id="2471" class="Symbol">→</a>  <a id="2474" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2476" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2478" href="Code.html#274" class="Generalizable">B</a>
</pre>
            </code>
            <div class="left fragment">
              <div>Casts = upcasts and downcasts:</div>
              <code>
                
<pre class="Agda">  <a id="1741" class="Keyword">data</a> <a id="T._=&gt;_"></a><a id="1746" href="Code.html#1746" class="Datatype Operator">_=&gt;_</a> <a id="1751" class="Symbol">:</a> <a id="1753" href="Code.html#172" class="Datatype">Type</a> <a id="1758" class="Symbol">→</a> <a id="1760" href="Code.html#172" class="Datatype">Type</a> <a id="1765" class="Symbol">→</a> <a id="1767" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1771" class="Keyword">where</a>
    <a id="T._=&gt;_.+_"></a><a id="1781" href="Code.html#1781" class="InductiveConstructor Operator">+_</a> <a id="1784" class="Symbol">:</a>
         <a id="1795" href="Code.html#269" class="Generalizable">A</a> <a id="1797" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1799" href="Code.html#274" class="Generalizable">B</a>
         <a id="1810" class="Comment">------ upcast</a>
      <a id="1830" class="Symbol">→</a>  <a id="1833" href="Code.html#269" class="Generalizable">A</a> <a id="1835" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="1838" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._=&gt;_.-_"></a><a id="1845" href="Code.html#1845" class="InductiveConstructor Operator">-_</a> <a id="1848" class="Symbol">:</a>
         <a id="1859" href="Code.html#274" class="Generalizable">B</a> <a id="1861" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1863" href="Code.html#269" class="Generalizable">A</a>
         <a id="1874" class="Comment">------ downcast</a>
      <a id="1896" class="Symbol">→</a>  <a id="1899" href="Code.html#269" class="Generalizable">A</a> <a id="1901" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="1904" href="Code.html#274" class="Generalizable">B</a>
</pre>
              </code>
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            Operational Semantics of Cast Calculus
          </section>
          <section>
            <div>Values of type \(\star\): boxes</div>
            <code>
              
<pre class="Agda">    <a id="T._⊢_._⇑_"></a><a id="2529" href="Code.html#2529" class="InductiveConstructor Operator">_⇑_</a> <a id="2533" class="Symbol">:</a>
         <a id="2544" class="Symbol">(</a><a id="2545" href="Code.html#2545" class="Bound">M</a> <a id="2547" class="Symbol">:</a> <a id="2549" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2551" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2553" href="Code.html#279" class="Generalizable">G</a><a id="2554" class="Symbol">)</a>
      <a id="2562" class="Symbol">→</a>  <a id="2565" class="Symbol">(</a><a id="2566" href="Code.html#2566" class="Bound">g</a> <a id="2568" class="Symbol">:</a> <a id="2570" href="Code.html#626" class="Datatype">Ground</a> <a id="2577" href="Code.html#279" class="Generalizable">G</a><a id="2578" class="Symbol">)</a>
         <a id="2589" class="Comment">-------------- box</a>
      <a id="2614" class="Symbol">→</a>  <a id="2617" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2619" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2621" href="Code.html#193" class="InductiveConstructor">★</a>
</pre>
            </code>
            <div class="fragment">
              <div>Ground type is a "tag"</div>
              <code>
                
<pre class="Agda">  <a id="621" class="Keyword">data</a> <a id="T.Ground"></a><a id="626" href="Code.html#626" class="Datatype">Ground</a> <a id="633" class="Symbol">:</a> <a id="635" href="Code.html#172" class="Datatype">Type</a> <a id="640" class="Symbol">→</a> <a id="642" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="646" class="Keyword">where</a>

    <a id="T.Ground.★⇒★"></a><a id="657" href="Code.html#657" class="InductiveConstructor">★⇒★</a> <a id="661" class="Symbol">:</a> <a id="663" href="Code.html#626" class="Datatype">Ground</a> <a id="670" class="Symbol">(</a><a id="671" href="Code.html#193" class="InductiveConstructor">★</a> <a id="673" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="675" href="Code.html#193" class="InductiveConstructor">★</a><a id="676" class="Symbol">)</a>

    <a id="T.Ground.′ℕ"></a><a id="683" href="Code.html#683" class="InductiveConstructor">′ℕ</a> <a id="686" class="Symbol">:</a> <a id="688" href="Code.html#626" class="Datatype">Ground</a> <a id="695" href="Code.html#235" class="InductiveConstructor">′ℕ</a>
</pre>
              </code>
            </div>
          </section>
          <section>
            <div class="fragment">
              <div class="medium">A more informative encoding of precision/casts</div>
              <code>
                
<pre class="Agda">  <a id="749" class="Keyword">data</a> <a id="T._≤_"></a><a id="754" href="Code.html#754" class="Datatype Operator">_≤_</a> <a id="758" class="Symbol">:</a> <a id="760" href="Code.html#172" class="Datatype">Type</a> <a id="765" class="Symbol">→</a> <a id="767" href="Code.html#172" class="Datatype">Type</a> <a id="772" class="Symbol">→</a> <a id="774" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="778" class="Keyword">where</a>
    <a id="T._≤_._⇑_"></a><a id="788" href="Code.html#788" class="InductiveConstructor Operator">_⇑_</a> <a id="792" class="Symbol">:</a>        <a id="801" class="Comment">-- replaces the rule ≤★ : A ≤ ★</a>
        <a id="841" class="Symbol">(</a><a id="842" href="Code.html#842" class="Bound">p</a> <a id="844" class="Symbol">:</a> <a id="846" href="Code.html#269" class="Generalizable">A</a> <a id="848" href="Code.html#754" class="Datatype Operator">≤</a> <a id="850" href="Code.html#279" class="Generalizable">G</a><a id="851" class="Symbol">)</a>
      <a id="859" class="Symbol">→</a> <a id="861" class="Symbol">(</a><a id="862" href="Code.html#862" class="Bound">g</a> <a id="864" class="Symbol">:</a> <a id="866" href="Code.html#626" class="Datatype">Ground</a> <a id="873" href="Code.html#279" class="Generalizable">G</a><a id="874" class="Symbol">)</a>
        <a id="884" class="Comment">-----</a>
      <a id="896" class="Symbol">→</a> <a id="898" href="Code.html#269" class="Generalizable">A</a> <a id="900" href="Code.html#754" class="Datatype Operator">≤</a> <a id="902" href="Code.html#193" class="InductiveConstructor">★</a>

    <a id="T._≤_.id"></a><a id="909" href="Code.html#909" class="InductiveConstructor">id</a> <a id="912" class="Symbol">:</a>
        <a id="922" class="Comment">-----</a>
        <a id="936" href="Code.html#269" class="Generalizable">A</a> <a id="938" href="Code.html#754" class="Datatype Operator">≤</a> <a id="940" href="Code.html#269" class="Generalizable">A</a>

    <a id="T._≤_._⇒_"></a><a id="947" href="Code.html#947" class="InductiveConstructor Operator">_⇒_</a> <a id="951" class="Symbol">:</a>
        <a id="961" href="Code.html#269" class="Generalizable">A</a> <a id="963" href="Code.html#754" class="Datatype Operator">≤</a> <a id="965" href="Code.html#271" class="Generalizable">A′</a>
      <a id="974" class="Symbol">→</a> <a id="976" href="Code.html#274" class="Generalizable">B</a> <a id="978" href="Code.html#754" class="Datatype Operator">≤</a> <a id="980" href="Code.html#276" class="Generalizable">B′</a>
        <a id="991" class="Comment">-------------------</a>
      <a id="1017" class="Symbol">→</a> <a id="1019" class="Symbol">(</a><a id="1020" href="Code.html#269" class="Generalizable">A</a> <a id="1022" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="1024" href="Code.html#274" class="Generalizable">B</a><a id="1025" class="Symbol">)</a> <a id="1027" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1029" class="Symbol">(</a><a id="1030" href="Code.html#271" class="Generalizable">A′</a> <a id="1033" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="1035" href="Code.html#276" class="Generalizable">B′</a><a id="1037" class="Symbol">)</a>
</pre>
              </code>
            </div>
          </section>
          <section>
            <div>Operational semantics of boxes <code>V ⇑ g</code></div>
            <code>
              
<pre class="Agda">  <a id="3310" class="Keyword">data</a> <a id="T._↦_"></a><a id="3315" href="Code.html#3315" class="Datatype Operator">_↦_</a> <a id="3319" class="Symbol">:</a> <a id="3321" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3323" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3325" href="Code.html#269" class="Generalizable">A</a> <a id="3327" class="Symbol">→</a> <a id="3329" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3331" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3333" href="Code.html#269" class="Generalizable">A</a> <a id="3335" class="Symbol">→</a> <a id="3337" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3341" class="Keyword">where</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.expand"></a><a id="3394" href="Code.html#3394" class="InductiveConstructor">expand</a> <a id="3401" class="Symbol">:</a> <a id="3403" class="Symbol">∀</a> <a id="3405" class="Symbol">{</a><a id="3406" href="Code.html#3406" class="Bound">V</a> <a id="3408" class="Symbol">:</a> <a id="3410" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3412" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3414" href="Code.html#269" class="Generalizable">A</a><a id="3415" class="Symbol">}</a> <a id="3417" class="Symbol">{</a><a id="3418" href="Code.html#3418" class="Bound">p</a> <a id="3420" class="Symbol">:</a> <a id="3422" href="Code.html#269" class="Generalizable">A</a> <a id="3424" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3426" href="Code.html#279" class="Generalizable">G</a><a id="3427" class="Symbol">}</a>
      <a id="3435" class="Symbol">→</a> <a id="3437" href="Code.html#3064" class="Datatype">Value</a> <a id="3443" href="Code.html#3406" class="Bound">V</a>
      <a id="3451" class="Symbol">→</a> <a id="3453" class="Symbol">(</a><a id="3454" href="Code.html#3454" class="Bound">g</a> <a id="3456" class="Symbol">:</a> <a id="3458" href="Code.html#626" class="Datatype">Ground</a> <a id="3465" href="Code.html#279" class="Generalizable">G</a><a id="3466" class="Symbol">)</a>
        <a id="3476" class="Comment">-------------------------------------</a>
      <a id="3520" class="Symbol">→</a> <a id="3522" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3527" class="Symbol">(</a><a id="3528" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="3530" class="Symbol">(</a><a id="3531" href="Code.html#3418" class="Bound">p</a> <a id="3533" class="InductiveConstructor Operator">⇑</a> <a id="3535" href="Code.html#3454" class="Bound">g</a><a id="3536" class="Symbol">))</a> <a id="3539" href="Code.html#3406" class="Bound">V</a> <a id="3541" href="Code.html#3315" class="Datatype Operator">↦</a> <a id="3543" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3548" class="Symbol">(</a><a id="3549" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="3551" href="Code.html#3418" class="Bound">p</a><a id="3552" class="Symbol">)</a> <a id="3554" href="Code.html#3406" class="Bound">V</a> <a id="3556" class="InductiveConstructor Operator">⇑</a> <a id="3558" href="Code.html#3454" class="Bound">g</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.collapse"></a><a id="3607" href="Code.html#3607" class="InductiveConstructor">collapse</a> <a id="3616" class="Symbol">:</a> <a id="3618" class="Symbol">∀</a> <a id="3620" class="Symbol">{</a><a id="3621" href="Code.html#3621" class="Bound">V</a> <a id="3623" class="Symbol">:</a> <a id="3625" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3627" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3629" href="Code.html#279" class="Generalizable">G</a><a id="3630" class="Symbol">}</a> <a id="3632" class="Symbol">{</a><a id="3633" href="Code.html#3633" class="Bound">p</a> <a id="3635" class="Symbol">:</a> <a id="3637" href="Code.html#269" class="Generalizable">A</a> <a id="3639" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3641" href="Code.html#279" class="Generalizable">G</a><a id="3642" class="Symbol">}</a>
      <a id="3650" class="Symbol">→</a> <a id="3652" href="Code.html#3064" class="Datatype">Value</a> <a id="3658" href="Code.html#3621" class="Bound">V</a>
      <a id="3666" class="Symbol">→</a> <a id="3668" class="Symbol">(</a><a id="3669" href="Code.html#3669" class="Bound">g</a> <a id="3671" class="Symbol">:</a> <a id="3673" href="Code.html#626" class="Datatype">Ground</a> <a id="3680" href="Code.html#279" class="Generalizable">G</a><a id="3681" class="Symbol">)</a>
        <a id="3691" class="Comment">---------------------------------------</a>
      <a id="3737" class="Symbol">→</a> <a id="3739" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3744" class="Symbol">(</a><a id="3745" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3747" class="Symbol">(</a><a id="3748" href="Code.html#3633" class="Bound">p</a> <a id="3750" class="InductiveConstructor Operator">⇑</a> <a id="3752" href="Code.html#3669" class="Bound">g</a><a id="3753" class="Symbol">))</a> <a id="3756" class="Symbol">(</a><a id="3757" href="Code.html#3621" class="Bound">V</a> <a id="3759" class="InductiveConstructor Operator">⇑</a> <a id="3761" href="Code.html#3669" class="Bound">g</a><a id="3762" class="Symbol">)</a> <a id="3764" href="Code.html#3315" class="Datatype Operator">↦</a> <a id="3766" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3771" class="Symbol">(</a><a id="3772" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3774" href="Code.html#3633" class="Bound">p</a><a id="3775" class="Symbol">)</a> <a id="3777" href="Code.html#3621" class="Bound">V</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.collide"></a><a id="3826" href="Code.html#3826" class="InductiveConstructor">collide</a>  <a id="3835" class="Symbol">:</a> <a id="3837" class="Symbol">∀</a> <a id="3839" class="Symbol">{</a><a id="3840" href="Code.html#3840" class="Bound">V</a> <a id="3842" class="Symbol">:</a> <a id="3844" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3846" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3848" href="Code.html#279" class="Generalizable">G</a><a id="3849" class="Symbol">}</a> <a id="3851" class="Symbol">{</a><a id="3852" href="Code.html#3852" class="Bound">p</a> <a id="3854" class="Symbol">:</a> <a id="3856" href="Code.html#269" class="Generalizable">A</a> <a id="3858" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3860" href="Code.html#281" class="Generalizable">H</a><a id="3861" class="Symbol">}</a>
      <a id="3869" class="Symbol">→</a> <a id="3871" href="Code.html#3064" class="Datatype">Value</a> <a id="3877" href="Code.html#3840" class="Bound">V</a>
      <a id="3885" class="Symbol">→</a> <a id="3887" class="Symbol">(</a><a id="3888" href="Code.html#3888" class="Bound">g</a> <a id="3890" class="Symbol">:</a> <a id="3892" href="Code.html#626" class="Datatype">Ground</a> <a id="3899" href="Code.html#279" class="Generalizable">G</a><a id="3900" class="Symbol">)</a>
      <a id="3908" class="Symbol">→</a> <a id="3910" class="Symbol">(</a><a id="3911" href="Code.html#3911" class="Bound">h</a> <a id="3913" class="Symbol">:</a> <a id="3915" href="Code.html#626" class="Datatype">Ground</a> <a id="3922" href="Code.html#281" class="Generalizable">H</a><a id="3923" class="Symbol">)</a>
      <a id="3931" class="Symbol">→</a> <a id="3933" href="Code.html#279" class="Generalizable">G</a> <a id="3935" href="Relation.Binary.PropositionalEquality.Core.html#839" class="Function Operator">≢</a> <a id="3937" href="Code.html#281" class="Generalizable">H</a>
        <a id="3947" class="Comment">--------------------------------</a>
      <a id="3986" class="Symbol">→</a> <a id="3988" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3993" class="Symbol">(</a><a id="3994" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3996" class="Symbol">(</a><a id="3997" href="Code.html#3852" class="Bound">p</a> <a id="3999" class="InductiveConstructor Operator">⇑</a> <a id="4001" href="Code.html#3911" class="Bound">h</a><a id="4002" class="Symbol">))</a> <a id="4005" class="Symbol">(</a><a id="4006" href="Code.html#3840" class="Bound">V</a> <a id="4008" class="InductiveConstructor Operator">⇑</a> <a id="4010" href="Code.html#3888" class="Bound">g</a><a id="4011" class="Symbol">)</a> <a id="4013" href="Code.html#3315" class="Datatype Operator">↦</a> <a id="4015" href="Code.html#2651" class="InductiveConstructor">blame</a>
</pre>
            </code>
          </section>
          <section>
            <div>Operational semantics of function casts <code>(∓s ⇒ ±t)</code></div>
            <code>
              
<pre class="Agda">    <a id="T._↦_.wrap"></a><a id="4066" href="Code.html#4066" class="InductiveConstructor">wrap</a> <a id="4071" class="Symbol">:</a> <a id="4073" class="Symbol">∀</a> <a id="4075" class="Symbol">{</a><a id="4076" href="Code.html#4076" class="Bound">N</a> <a id="4078" class="Symbol">:</a> <a id="4080" href="Code.html#1189" class="Generalizable">Γ</a> <a id="4082" href="Code.html#1110" class="InductiveConstructor Operator">▷</a> <a id="4084" href="Code.html#269" class="Generalizable">A</a> <a id="4086" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="4088" href="Code.html#274" class="Generalizable">B</a><a id="4089" class="Symbol">}</a>
        <a id="4099" class="Symbol">{</a><a id="4100" href="Code.html#4100" class="Bound">∓s</a> <a id="4103" class="Symbol">:</a> <a id="4105" href="Code.html#271" class="Generalizable">A′</a> <a id="4108" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4111" href="Code.html#269" class="Generalizable">A</a><a id="4112" class="Symbol">}</a> <a id="4114" class="Symbol">{</a><a id="4115" href="Code.html#4115" class="Bound">±t</a> <a id="4118" class="Symbol">:</a> <a id="4120" href="Code.html#274" class="Generalizable">B</a> <a id="4122" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4125" href="Code.html#276" class="Generalizable">B′</a><a id="4127" class="Symbol">}</a> <a id="4129" class="Symbol">{</a><a id="4130" href="Code.html#4130" class="Bound">±p</a> <a id="4133" class="Symbol">:</a> <a id="4135" href="Code.html#269" class="Generalizable">A</a> <a id="4137" class="InductiveConstructor Operator">⇒</a> <a id="4139" href="Code.html#274" class="Generalizable">B</a> <a id="4141" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4144" href="Code.html#271" class="Generalizable">A′</a> <a id="4147" class="InductiveConstructor Operator">⇒</a> <a id="4149" href="Code.html#276" class="Generalizable">B′</a><a id="4151" class="Symbol">}</a>
      <a id="4159" class="Symbol">→</a> <a id="4161" href="Code.html#3213" class="Function">split</a> <a id="4167" href="Code.html#4130" class="Bound">±p</a> <a id="4170" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4172" href="Code.html#4100" class="Bound">∓s</a> <a id="4175" class="InductiveConstructor Operator">⇒</a> <a id="4177" href="Code.html#4115" class="Bound">±t</a>
        <a id="4188" class="Comment">----------------------------------------------------</a>
      <a id="4247" class="Symbol">→</a> <a id="4249" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4254" href="Code.html#4130" class="Bound">±p</a> <a id="4257" class="Symbol">(</a><a id="4258" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4260" href="Code.html#4076" class="Bound">N</a><a id="4261" class="Symbol">)</a> <a id="4263" href="Code.html#3315" class="Datatype Operator">↦</a> <a id="4265" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4267" class="Symbol">(</a><a id="4268" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4273" href="Code.html#4115" class="Bound">±t</a> <a id="4276" class="Symbol">(</a><a id="4277" href="Code.html#3008" class="Function">lift</a> <a id="4282" class="Symbol">(</a><a id="4283" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4285" href="Code.html#4076" class="Bound">N</a><a id="4286" class="Symbol">)</a> <a id="4288" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="4290" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4295" href="Code.html#4100" class="Bound">∓s</a> <a id="4298" class="Symbol">(</a><a id="4299" href="Code.html#2264" class="InductiveConstructor Operator">`</a> <a id="4301" href="Code.html#2001" class="InductiveConstructor">Z</a><a id="4302" class="Symbol">)))</a>
</pre>
            </code>
            <div>Rewritten with variable names:<br>
              <code class="medium-small">cast (∓s ⇒ ±t) f  ↦  λ x. cast ±t (f (cast ∓s x)) </code></div>
          </section>
          <section>
            <div>Progress <span class="strike">and preservation</span></div>
            <div class="flexbox">
            <code class="flex-2">
              
<pre class="Agda">  <a id="5323" class="Keyword">data</a> <a id="W.Progress"></a><a id="5328" href="Code.html#5328" class="Datatype">Progress</a> <a id="5337" class="Symbol">:</a> <a id="5339" class="Symbol">(</a><a id="5340" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5342" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5344" href="Code.html#5281" class="Generalizable">A</a><a id="5345" class="Symbol">)</a> <a id="5347" class="Symbol">→</a> <a id="5349" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="5353" class="Keyword">where</a>

    <a id="W.Progress.step"></a><a id="5364" href="Code.html#5364" class="InductiveConstructor">step</a> <a id="5369" class="Symbol">:</a> <a id="5371" class="Symbol">∀</a> <a id="5373" class="Symbol">{</a><a id="5374" href="Code.html#5374" class="Bound">M</a> <a id="5376" href="Code.html#5376" class="Bound">N</a> <a id="5378" class="Symbol">:</a> <a id="5380" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5382" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5384" href="Code.html#5281" class="Generalizable">A</a><a id="5385" class="Symbol">}</a>
      <a id="5393" class="Symbol">→</a>  <a id="5396" href="Code.html#5374" class="Bound">M</a> <a id="5398" href="Progress.html#15477" class="Datatype Operator">—→</a> <a id="5401" href="Code.html#5376" class="Bound">N</a>
         <a id="5412" class="Comment">----------</a>
      <a id="5429" class="Symbol">→</a>  <a id="5432" href="Code.html#5328" class="Datatype">Progress</a> <a id="5441" href="Code.html#5374" class="Bound">M</a>

    <a id="W.Progress.done"></a><a id="5448" href="Code.html#5448" class="InductiveConstructor">done</a> <a id="5453" class="Symbol">:</a> <a id="5455" class="Symbol">∀</a> <a id="5457" class="Symbol">{</a><a id="5458" href="Code.html#5458" class="Bound">M</a> <a id="5460" class="Symbol">:</a> <a id="5462" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5464" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5466" href="Code.html#5281" class="Generalizable">A</a><a id="5467" class="Symbol">}</a>
      <a id="5475" class="Symbol">→</a>  <a id="5478" href="Core.html#22063" class="Datatype">Value</a> <a id="5484" href="Code.html#5458" class="Bound">M</a>
         <a id="5495" class="Comment">----------</a>
      <a id="5512" class="Symbol">→</a>  <a id="5515" href="Code.html#5328" class="Datatype">Progress</a> <a id="5524" href="Code.html#5458" class="Bound">M</a>

    <a id="W.Progress.blame"></a><a id="5531" href="Code.html#5531" class="InductiveConstructor">blame</a> <a id="5537" class="Symbol">:</a> <a id="5539" class="Symbol">∀</a> <a id="5541" class="Symbol">{</a><a id="5542" href="Code.html#5542" class="Bound">Q</a><a id="5543" class="Symbol">}</a>
      <a id="5551" class="Symbol">→</a>  <a id="5554" class="Symbol">(</a><a id="5555" href="Code.html#5555" class="Bound">E</a> <a id="5557" class="Symbol">:</a> <a id="5559" href="Progress.html#904" class="Datatype">Frame</a> <a id="5565" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5567" href="Code.html#5542" class="Bound">Q</a> <a id="5569" href="Code.html#5281" class="Generalizable">A</a><a id="5570" class="Symbol">)</a>
         <a id="5581" class="Comment">---------------------</a>
      <a id="5609" class="Symbol">→</a>  <a id="5612" href="Code.html#5328" class="Datatype">Progress</a> <a id="5621" class="Symbol">(</a><a id="5622" href="Code.html#5555" class="Bound">E</a> <a id="5624" href="Progress.html#2827" class="Function Operator">⟦</a> <a id="5626" href="Core.html#4129" class="InductiveConstructor">blame</a> <a id="5632" href="Progress.html#2827" class="Function Operator">⟧</a><a id="5633" class="Symbol">)</a>
</pre>
            </code>
            <code class="fragment flex-1">
              
<pre class="Agda">  <a id="5683" class="Comment">-- Theorem</a>
  <a id="W.progress"></a><a id="5696" href="Code.html#5696" class="Function">progress</a> <a id="5705" class="Symbol">:</a>
      <a id="5713" class="Symbol">(</a><a id="5714" href="Code.html#5714" class="Bound">M</a> <a id="5716" class="Symbol">:</a> <a id="5718" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5720" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5722" href="Code.html#5281" class="Generalizable">A</a><a id="5723" class="Symbol">)</a>
      <a id="5731" class="Comment">-----------</a>
    <a id="5747" class="Symbol">→</a> <a id="5749" href="Code.html#5328" class="Datatype">Progress</a> <a id="5758" href="Code.html#5714" class="Bound">M</a>
  <a id="5762" href="Code.html#5696" class="Function">progress</a> <a id="5771" class="Symbol">=</a> <a id="5773" href="Code.html#120" class="Postulate">todo</a>
</pre>
            </code>
            </div>
            <div class="fragment">Progress proof \(\overset{\text{Curry-Howard}}{=}\) Interpreter</div>
          </section>
          <section>
            <div class="medium-small">Example: how to box <code>f : nat → nat</code> in \(\star\)</div>
            <div>
              <code class="fragment">
                
<pre class="Agda">          <a id="4492" href="Code.html#4492" class="Bound">M</a> <a id="4494" class="Symbol">=</a> <a id="4496" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4501" class="Symbol">(</a><a id="4502" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4504" class="Symbol">((</a><a id="4506" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4509" class="InductiveConstructor Operator">⇑</a> <a id="4511" class="InductiveConstructor">′ℕ</a><a id="4513" class="Symbol">)</a> <a id="4515" class="InductiveConstructor Operator">⇒</a> <a id="4517" class="Symbol">(</a><a id="4518" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4521" class="InductiveConstructor Operator">⇑</a> <a id="4523" class="InductiveConstructor">′ℕ</a><a id="4525" class="Symbol">))</a> <a id="4528" class="InductiveConstructor Operator">⇑</a> <a id="4530" href="Code.html#657" class="InductiveConstructor">★⇒★</a><a id="4533" class="Symbol">)</a> <a id="4535" href="Code.html#4437" class="Bound">f</a>
</pre>
              </code>
              <code class="fragment">
                
<pre class="Agda">            <a id="4627" class="Comment">-- by expand</a>
            <a id="4652" href="Code.html#3315" class="Datatype Operator">↦</a>  <a id="4655" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4660" class="Symbol">(</a><a id="4661" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4663" class="Symbol">((</a><a id="4665" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4668" class="InductiveConstructor Operator">⇑</a> <a id="4670" class="InductiveConstructor">′ℕ</a><a id="4672" class="Symbol">)</a> <a id="4674" class="InductiveConstructor Operator">⇒</a> <a id="4676" class="Symbol">(</a><a id="4677" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4680" class="InductiveConstructor Operator">⇑</a> <a id="4682" class="InductiveConstructor">′ℕ</a><a id="4684" class="Symbol">)))</a> <a id="4688" href="Code.html#4437" class="Bound">f</a> <a id="4690" class="InductiveConstructor Operator">⇑</a> <a id="4692" href="Code.html#657" class="InductiveConstructor">★⇒★</a>
</pre>
              </code>
              <code class="fragment">
                
<pre class="Agda">            <a id="4786" class="Comment">-- by wrap</a>
            <a id="4809" href="Code.html#3315" class="Datatype Operator">↦</a>  <a id="4812" class="Symbol">(</a><a id="4813" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4815" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4820" class="Symbol">(</a><a id="4821" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4823" class="Symbol">(</a><a id="4824" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4827" class="InductiveConstructor Operator">⇑</a> <a id="4829" class="InductiveConstructor">′ℕ</a><a id="4831" class="Symbol">))</a>
                        <a id="4858" class="Symbol">(</a> <a id="4860" href="Code.html#3008" class="Function">lift</a> <a id="4865" href="Code.html#4437" class="Bound">f</a>
                        <a id="4891" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="4893" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4898" class="Symbol">(</a><a id="4899" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="4901" class="Symbol">(</a><a id="4902" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4905" class="InductiveConstructor Operator">⇑</a> <a id="4907" class="InductiveConstructor">′ℕ</a><a id="4909" class="Symbol">))</a> <a id="4912" class="Symbol">(</a><a id="4913" href="Code.html#2264" class="InductiveConstructor Operator">`</a> <a id="4915" href="Code.html#2001" class="InductiveConstructor">Z</a><a id="4916" class="Symbol">)))</a>  <a id="4921" class="InductiveConstructor Operator">⇑</a> <a id="4923" href="Code.html#657" class="InductiveConstructor">★⇒★</a>
            <a id="4939" class="Comment">--  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</a>
            <a id="4999" class="Comment">--  Value ((ƛ _) ⇑ ★⇒★)</a>
</pre>
              </code>
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            The Gradual Guarantee
          </section>
          <section>
            <div class="medium">Starting from a statically typed program (no \(\star\)), removing type annotations
              \(\importanttypecolor{\text{cannot change}}\) its behavior in any way.</div>
            <div><img class="col-2" src="graduality-1-tex.svg" width="250" height="250"/></div>

          </section>
          <section>
            <div class="medium">If you add more type annotations to a program, then you may cause a \(\castcolor{\text{type error}}\), but otherwise \(\importanttypecolor{\text{no change}}\) to the value of a program.</div>
            <div><img class="col-2" src="graduality-2-tex.svg" width="250" height="250"/></div>

          </section>
          <section>
            <style>
              .container { display: flex; align-items: center; }
              .col-1 { flex: 2; } .col-2 { flex: 1; }
            </style>
            <div class="container">
              <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁺≤"></a><a id="6172" href="Code.html#6172" class="Function">cast⁺≤</a> <a id="6179" class="Symbol">:</a> <a id="6181" class="Symbol">{</a><a id="6182" href="Code.html#6182" class="Bound">p</a> <a id="6184" class="Symbol">:</a> <a id="6186" href="Code.html#6016" class="Generalizable">P</a> <a id="6188" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6191" href="Code.html#6021" class="Generalizable">Q</a><a id="6192" class="Symbol">}</a> <a id="6194" class="Symbol">{</a><a id="6195" href="Code.html#6195" class="Bound">q</a> <a id="6197" class="Symbol">:</a> <a id="6199" href="Code.html#6021" class="Generalizable">Q</a> <a id="6201" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6204" href="Code.html#6023" class="Generalizable">R</a><a id="6205" class="Symbol">}</a> <a id="6207" class="Symbol">{</a><a id="6208" href="Code.html#6208" class="Bound">r</a> <a id="6210" class="Symbol">:</a> <a id="6212" href="Code.html#6016" class="Generalizable">P</a> <a id="6214" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6217" href="Code.html#6023" class="Generalizable">R</a><a id="6218" class="Symbol">}</a>
    <a id="6224" class="Symbol">→</a>  <a id="6227" href="Code.html#6182" class="Bound">p</a> <a id="6229" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="6232" href="Code.html#6195" class="Bound">q</a> <a id="6234" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6236" href="Code.html#6208" class="Bound">r</a>       <a id="6244" class="Comment">-- ← commutative triangle</a>
    <a id="6274" class="Symbol">→</a>  <a id="6277" href="Code.html#6052" class="Generalizable">Γ≤</a> <a id="6280" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6282" href="Code.html#6093" class="Generalizable">M</a> <a id="6284" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6287" href="Code.html#6105" class="Generalizable">M′</a> <a id="6290" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6292" href="Code.html#6208" class="Bound">r</a>
       <a id="6301" class="Comment">---------------------------</a>
    <a id="6333" class="Symbol">→</a>  <a id="6336" href="Code.html#6052" class="Generalizable">Γ≤</a> <a id="6339" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6341" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="6346" class="Symbol">(</a><a id="6347" href="Type.html#15288" class="InductiveConstructor Operator">+</a> <a id="6349" href="Code.html#6182" class="Bound">p</a><a id="6350" class="Symbol">)</a> <a id="6352" href="Code.html#6093" class="Generalizable">M</a> <a id="6354" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6357" href="Code.html#6105" class="Generalizable">M′</a> <a id="6360" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6362" href="Code.html#6195" class="Bound">q</a>
</pre></code>
              <img class="col-2" src="cast-left-plus-tex.svg" width="250" height="250"/>
            </div>
            <div class="container">
              <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁻≤"></a><a id="6443" href="Code.html#6443" class="Function">cast⁻≤</a> <a id="6450" class="Symbol">:</a> <a id="6452" class="Symbol">{</a><a id="6453" href="Code.html#6453" class="Bound">p</a> <a id="6455" class="Symbol">:</a> <a id="6457" href="Code.html#6021" class="Generalizable">Q</a> <a id="6459" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6462" href="Code.html#6016" class="Generalizable">P</a><a id="6463" class="Symbol">}</a> <a id="6465" class="Symbol">{</a><a id="6466" href="Code.html#6466" class="Bound">q</a> <a id="6468" class="Symbol">:</a> <a id="6470" href="Code.html#6021" class="Generalizable">Q</a> <a id="6472" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6475" href="Code.html#6023" class="Generalizable">R</a><a id="6476" class="Symbol">}</a> <a id="6478" class="Symbol">{</a><a id="6479" href="Code.html#6479" class="Bound">r</a> <a id="6481" class="Symbol">:</a> <a id="6483" href="Code.html#6016" class="Generalizable">P</a> <a id="6485" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6488" href="Code.html#6023" class="Generalizable">R</a><a id="6489" class="Symbol">}</a>
    <a id="6495" class="Symbol">→</a>  <a id="6498" href="Code.html#6453" class="Bound">p</a> <a id="6500" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="6503" href="Code.html#6479" class="Bound">r</a> <a id="6505" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6507" href="Code.html#6466" class="Bound">q</a>       <a id="6515" class="Comment">-- ← commutative triangle</a>
    <a id="6545" class="Symbol">→</a>  <a id="6548" href="Code.html#6052" class="Generalizable">Γ≤</a> <a id="6551" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6553" href="Code.html#6093" class="Generalizable">M</a> <a id="6555" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6558" href="Code.html#6105" class="Generalizable">M′</a> <a id="6561" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6563" href="Code.html#6479" class="Bound">r</a>
       <a id="6572" class="Comment">--------------------------</a>
    <a id="6603" class="Symbol">→</a>  <a id="6606" href="Code.html#6052" class="Generalizable">Γ≤</a> <a id="6609" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6611" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="6616" class="Symbol">(</a><a id="6617" href="Type.html#15391" class="InductiveConstructor Operator">-</a> <a id="6619" href="Code.html#6453" class="Bound">p</a><a id="6620" class="Symbol">)</a> <a id="6622" href="Code.html#6093" class="Generalizable">M</a> <a id="6624" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6627" href="Code.html#6105" class="Generalizable">M′</a> <a id="6630" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6632" href="Code.html#6466" class="Bound">q</a>
</pre></code>
              <img class="col-2" src="cast-left-minus-tex.svg" width="250" height="250"/>
            </div>
          </section>
        </section>


        <section>
          END
        </section>


			</div>
		</div>

		<script src="reveal.js/dist/reveal.js"></script>
		<script src="reveal.js/plugin/notes/notes.js"></script>
		<script src="reveal.js/plugin/markdown/markdown.js"></script>
		<script src="reveal.js/plugin/highlight/highlight.js"></script>
    <script src="reveal.js/plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
        slideNumber: 'c',
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.MathJax3 ],
        mathjax3: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          tex: {
            inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ]  ]
          },
          options: {
            skipHtmlTags: [ 'script', 'noscript', 'style', 'textarea', 'pre' ]
          },
        }
			});
		</script>
	</body>
</html>