<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Formalizing gradual types in Agda</title>

		<link rel="stylesheet" href="reveal.js/dist/reset.css">
		<link rel="stylesheet" href="reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="reveal.js/dist/theme/serif.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="reveal.js/plugin/highlight/default.css">
		<link rel="stylesheet" href="Agda.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
    <div hidden>
      \(
        \def\N{\mathbb{N}}
        \def\B{\mathbb{B}}
        \def\nat{\N}
        \def\bool{\B}
        \definecolor{deemph}{RGB}{75,75,75}
        \definecolor{bbb}{RGB}{0,100,255}
        \def\typecolor#1{{\color{Blue}#1}}
        \def\termcolor#1{{\color{deemph}#1}}
        \def\castcolor#1{{\color{RedOrange}#1}}
        \def\importanttypecolor#1{{\color{bbb}#1}}
        \def\precision#1#2{{\color{Blue}#1 \color{Green} \le \color{Blue} #2}}

        \def\lam#1#2{\lambda#1. #2}
        \def\app#1#2{#1\,#2}
        \def\castof#1{\texttt{cast}^{#1}}
        \def\hastype#1#2#3{\typecolor{#1} \vdash \termcolor{#2} : \typecolor{#3}}
      \)
    </div>
		<div class="reveal">
			<div class="slides">
				<section>
          <h2>Gradual typing for effect handlers</h2>
          <div style="text-align:right;">
            <div><b>Li-yao Xia</b></div>
            <div>Philip Wadler</div>
          </div>
        </section>
<!--
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            <div class="flexbox">
              <div style="color: white;">Dynamic</div>
              <div class="flex-1"></div>
              <div>Static</div>
            </div>
            <div style="height: 150px;"></div>
            <h3 class="height-half">Gradual types</h3>
            <div style="height: 150px;"></div>
            <div class="medium-small">Credit to Siek, Thiemannm, Wadler</div>
          </section>
          <section>
            <div class="flexbox">
              <div class="flex-1">
<div>Library</div>
<div class="gradual-box"><div class="gradual-label right">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
write_to_db(row : Any) : Any
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="1"><div class="gradual-label right">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
write_to_db(row : N × N) : ()
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="2"><div class="gradual-label right">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
write_to_db(row : Any) : Any
 
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="0"><div class="gradual-label right">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
write_to_db(row : N × N) : ()
 
</code></pre>
</div>
              </div>
              <div class="flex-1">
<div>Application</div>
<div class="gradual-box"><div class="gradual-label left">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
get_data() : Any
write_to_db(get_data()) : Any
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="1"><div class="gradual-label left">Dynamic</div>
<pre><code data-trim data-noescape class="language-ocaml">
get_data() : Any
write_to_db(get_data()) : Any
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="2"><div class="gradual-label left">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
get_data() : N × N
write_to_db(get_data()) : ()
</code></pre>
</div>
<div class="fragment gradual-box" data-fragment-index="0"><div class="gradual-label left">Static</div>
<pre class="border"><code data-trim data-noescape class="language-ocaml">
get_data() : N × N
write_to_db(get_data()) : ()
</code></pre>
</div>
              </div>
            </div>
            <div>Well-typed throughout gradual migration</div>
          </section>
          <section>
            <blockquote class="medium-small">
            But languages with dynamic typing also have a flexibility which is hard to emulate with a static type system.
            <br>— <a href="https://kar.kent.ac.uk/88959/1/history.pdf_nocoversheet">Turner (2012)</a>
            </blockquote>
            <div>When static types go ¯\_(ツ)_/¯</div>
            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto : nat -> ★ -> bool
tauto 0 b = b
tauto n f = tauto (n-1) (f false) && tauto (n-1) (f true)
            </code></pre>
            </div>

            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto n f = true   iff   ∀ x1 ... xn, f x1 ... xn = true 
            </code></pre>
            </div>
            <div class="fragment">
            <pre><code data-trim data-noescape>
tauto 1 :                 (bool -> bool) -> bool
tauto 2 :         (bool -> bool -> bool) -> bool
tauto 3 : (bool -> bool -> bool -> bool) -> bool
            </code></pre>
            </div>
          </section>
          <section>
            <div>Anatomy of a gradually typed language</div>
            <ul style="list-style: none;">
              <li class="fragment"><b>Dynamic type</b> "\(\star\)" (aka. <code>Any</code>)</li>
              <li class="fragment margin-top-10"><b>Surface language:</b> \(f : \nat \to \bool, x : \star \vdash \app{f}{x} : \bool\)</li>
              <li class="fragment margin-top-10">Core language = <b>cast calculus:</b> \(f : \nat \to \bool, x : \star \vdash \app{f}{(\castof{-p}\,x)} : \bool\)</li>
              <li class="fragment">⮩ Operational semantics</li>
              <li class="fragment">⮩ <b>Gradual guarantee:</b> how code should behave when type annotations
                are added incrementally.</li>
            </ul>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            Surface language: a gradual type system
          </section>

          <section>
            <div class="left">Precision \(\precision{A}{B}\)</div>
            \[\begin{prooftree}
              \AxiomC{\(\precision{A}{\star}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
              \AxiomC{\(\precision{A}{A}\)}
            \end{prooftree}
            \quad
            \begin{prooftree}
                \AxiomC{\(\precision{A}{A'}\)}
                \AxiomC{\(\precision{B}{B'}\)}
              \BinaryInfC{\(\precision{A \to B}{A' \to B'}\)}
            \end{prooftree}
            \]
            <div class="fragment">Covariant in the domain!</div>
            <div class="fragment">Precision aka. "Naive Subtyping"</div>
            <div class="left fragment margin-top-10">
            <div>Gradual type system</div>
            \[\begin{prooftree}
                \AxiomC{\(\precision{A}{B}\)}
                \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
              \BinaryInfC{\(\hastype{\Gamma}{M}{A}\)}
            \end{prooftree}\]
            </div>
            <div class="right small"><em>A New Perspective</em>, Castagna et al., 2019</div>
          </section>
          <section>
            <div>Precision relation <code>A ≤ B</code></div>
          <code class="big">
            
<pre class="Agda">    <a id="346" class="Keyword">data</a> <a id="T.Fake._≤_"></a><a id="351" href="Code.html#351" class="Datatype Operator">_≤_</a> <a id="355" class="Symbol">:</a> <a id="357" href="Code.html#172" class="Datatype">Type</a> <a id="362" class="Symbol">→</a> <a id="364" href="Code.html#172" class="Datatype">Type</a> <a id="369" class="Symbol">→</a> <a id="371" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="375" class="Keyword">where</a>

      <a id="T.Fake._≤_.≤★"></a><a id="388" href="Code.html#388" class="InductiveConstructor">≤★</a> <a id="391" class="Symbol">:</a>
          <a id="403" class="Comment">-----</a>
          <a id="419" href="Code.html#269" class="Generalizable">A</a> <a id="421" href="Code.html#351" class="Datatype Operator">≤</a> <a id="423" href="Code.html#193" class="InductiveConstructor">★</a>

      <a id="T.Fake._≤_.id"></a><a id="432" href="Code.html#432" class="InductiveConstructor">id</a> <a id="435" class="Symbol">:</a>
          <a id="447" class="Comment">-----</a>
          <a id="463" href="Code.html#269" class="Generalizable">A</a> <a id="465" href="Code.html#351" class="Datatype Operator">≤</a> <a id="467" href="Code.html#269" class="Generalizable">A</a>

      <a id="T.Fake._≤_._⇒_"></a><a id="476" href="Code.html#476" class="InductiveConstructor Operator">_⇒_</a> <a id="480" class="Symbol">:</a>
          <a id="492" href="Code.html#269" class="Generalizable">A</a> <a id="494" href="Code.html#351" class="Datatype Operator">≤</a> <a id="496" href="Code.html#271" class="Generalizable">A′</a>
        <a id="507" class="Symbol">→</a> <a id="509" href="Code.html#274" class="Generalizable">B</a> <a id="511" href="Code.html#351" class="Datatype Operator">≤</a> <a id="513" href="Code.html#276" class="Generalizable">B′</a>
          <a id="526" class="Comment">-------------------</a>
        <a id="554" class="Symbol">→</a> <a id="556" class="Symbol">(</a><a id="557" href="Code.html#269" class="Generalizable">A</a> <a id="559" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="561" href="Code.html#274" class="Generalizable">B</a><a id="562" class="Symbol">)</a> <a id="564" href="Code.html#351" class="Datatype Operator">≤</a> <a id="566" class="Symbol">(</a><a id="567" href="Code.html#271" class="Generalizable">A′</a> <a id="570" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="572" href="Code.html#276" class="Generalizable">B′</a><a id="574" class="Symbol">)</a>
</pre>
          </code>
          </section>
          <section>
            <div>Well-typed terms <code>Γ ⊢ M ⦂ A</code></div>
          <code class="big">
            
<pre class="Agda">    <a id="1286" class="Keyword">data</a> <a id="T.W._⊢_⦂_"></a><a id="1291" href="Code.html#1291" class="Datatype Operator">_⊢_⦂_</a> <a id="1297" class="Symbol">:</a> <a id="1299" href="Code.html#1070" class="Datatype">Context</a> <a id="1307" class="Symbol">→</a> <a id="1309" href="Code.html#1148" class="Datatype">Term</a> <a id="1314" class="Symbol">→</a> <a id="1316" href="Code.html#172" class="Datatype">Type</a> <a id="1321" class="Symbol">→</a> <a id="1323" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1327" class="Keyword">where</a>

      <a id="T.W._⊢_⦂_.materialize"></a><a id="1340" href="Code.html#1340" class="InductiveConstructor">materialize</a> <a id="1352" class="Symbol">:</a>
           <a id="1365" href="Code.html#269" class="Generalizable">A</a> <a id="1367" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1369" href="Code.html#274" class="Generalizable">B</a>
        <a id="1379" class="Symbol">→</a>  <a id="1382" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1384" href="Code.html#1291" class="Datatype Operator">⊢</a> <a id="1386" href="Code.html#1205" class="Generalizable">M</a> <a id="1388" href="Code.html#1291" class="Datatype Operator">⦂</a> <a id="1390" href="Code.html#274" class="Generalizable">B</a>
           <a id="1403" class="Comment">---------</a>
        <a id="1421" class="Symbol">→</a>  <a id="1424" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1426" href="Code.html#1291" class="Datatype Operator">⊢</a> <a id="1428" href="Code.html#1205" class="Generalizable">M</a> <a id="1430" href="Code.html#1291" class="Datatype Operator">⦂</a> <a id="1432" href="Code.html#269" class="Generalizable">A</a>

      <a id="1441" class="Comment">-- etc.</a>
</pre>
          </code>
          </section>
          <section>
            <div>Example derivation</div>
            <div class="left">
              \(\termcolor{f} : \typecolor{\star \to \star}\)
              <br>\(\termcolor{x} : \typecolor{\nat}\)
              <br>\(\termcolor{\app{f}{x}} : \typecolor{\nat}\)
            </div>
            \[\begin{prooftree}
                    \AxiomC{\(\precision{\nat \to \nat}{\star \to \star}\)}
                    \AxiomC{\(\hastype{\Gamma}{f}{\star \to \star}\)}
                  \BinaryInfC{\(\hastype{\Gamma}{f}{\nat \to \nat}\)}
                  \AxiomC{\(\hastype{\Gamma}{x}{\nat}\)}
                \BinaryInfC{\(\hastype{\Gamma}{\app{f}{x}}{\nat}\)}
              \end{prooftree}
            \]
            <code class="fragment">
              

<pre class="Agda">    <a id="2841" class="Symbol">λ</a> <a id="2843" class="Symbol">(</a><a id="2844" href="Code.html#2844" class="Bound">f</a> <a id="2846" class="Symbol">:</a> <a id="2848" href="Code.html#2741" class="Bound">Γ</a> <a id="2850" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2852" href="Code.html#193" class="InductiveConstructor">★</a> <a id="2854" class="InductiveConstructor Operator">⇒</a> <a id="2856" href="Code.html#193" class="InductiveConstructor">★</a><a id="2857" class="Symbol">)</a>
      <a id="2865" class="Symbol">(</a><a id="2866" href="Code.html#2866" class="Bound">x</a> <a id="2868" class="Symbol">:</a> <a id="2870" href="Code.html#2741" class="Bound">Γ</a> <a id="2872" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2874" class="InductiveConstructor">′ℕ</a><a id="2876" class="Symbol">)</a> <a id="2878" class="Symbol">→</a>
      <a id="2886" class="Comment">------------------------------------</a>
      <a id="2929" class="Symbol">(</a><a id="2930" href="Code.html#2753" class="Bound">materialize</a> <a id="2942" href="Code.html#2676" class="Function">ℕ⇒ℕ≤★⇒★</a> <a id="2950" href="Code.html#2844" class="Bound">f</a><a id="2951" class="Symbol">)</a> <a id="2953" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="2955" href="Code.html#2866" class="Bound">x</a>  <a id="2958" class="Comment">-- : ′ℕ</a>
</pre>

            </code>
          </section>
          <section>
            <div>Gradual typing as a superset of static typing</div>
            <div>
              <p class="medium">
              If \(M\) is static (all binders annotated with non-\(\star\) types), then
              </p>
              \[\vdash_{\mathrm{Gradual}} M : A \iff \vdash_{\mathrm{STLC}} M : A\]
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            <div>Towards an operational semantics</div>
            <div>Compilation to a cast calculus</div>
          </section>
          <section>
            <div class="left">Surface language:
              \[\begin{prooftree}
                  \AxiomC{\(\precision{A}{B}\)}
                  \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
                \BinaryInfC{\(\hastype{\Gamma}{M}{A}\)}
              \end{prooftree}\]
            </div>
            <div class="fragment left">Cast calculus:
              \[\begin{prooftree}
                  \AxiomC{\(\castcolor{p :}\precision{A}{B}\)}
                  \AxiomC{\(\hastype{\Gamma}{M}{B}\)}
                \BinaryInfC{\(\hastype{\Gamma}{\castcolor{\castof{p}\,}M}{A}\)}
              \end{prooftree}\]
            </div>
          </section>
          <section>
            <div class="left">Surface:</div>
            <code>
              
<pre class="Agda">  <a id="1508" class="Keyword">data</a> <a id="T._⊢_⦂_"></a><a id="1513" href="Code.html#1513" class="Datatype Operator">_⊢_⦂_</a> <a id="1519" class="Symbol">:</a> <a id="1521" href="Code.html#1070" class="Datatype">Context</a> <a id="1529" class="Symbol">→</a> <a id="1531" href="Code.html#1148" class="Datatype">Term</a> <a id="1536" class="Symbol">→</a> <a id="1538" href="Code.html#172" class="Datatype">Type</a> <a id="1543" class="Symbol">→</a> <a id="1545" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1549" class="Keyword">where</a>

    <a id="T._⊢_⦂_.materialize"></a><a id="1560" href="Code.html#1560" class="InductiveConstructor">materialize</a> <a id="1572" class="Symbol">:</a>
         <a id="1583" class="Symbol">(</a><a id="1584" href="Code.html#1584" class="Bound">p</a> <a id="1586" class="Symbol">:</a> <a id="1588" href="Code.html#269" class="Generalizable">A</a> <a id="1590" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1592" href="Code.html#274" class="Generalizable">B</a><a id="1593" class="Symbol">)</a>
      <a id="1601" class="Symbol">→</a>  <a id="1604" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1606" href="Code.html#1513" class="Datatype Operator">⊢</a> <a id="1608" href="Code.html#1205" class="Generalizable">M</a> <a id="1610" href="Code.html#1513" class="Datatype Operator">⦂</a> <a id="1612" href="Code.html#274" class="Generalizable">B</a>
         <a id="1623" class="Comment">---------</a>
      <a id="1639" class="Symbol">→</a>  <a id="1642" href="Code.html#1189" class="Generalizable">Γ</a> <a id="1644" href="Code.html#1513" class="Datatype Operator">⊢</a> <a id="1646" href="Code.html#1205" class="Generalizable">M</a> <a id="1648" href="Code.html#1513" class="Datatype Operator">⦂</a> <a id="1650" href="Code.html#269" class="Generalizable">A</a>

    <a id="1657" class="Comment">-- etc.</a>
</pre>
            </code>
            <div>The derivation has (mostly) the right structure already.</div>
            <code class="fragment">
              
<pre class="Agda">    <a id="2841" class="Symbol">λ</a> <a id="2843" class="Symbol">(</a><a id="2844" href="Code.html#2844" class="Bound">f</a> <a id="2846" class="Symbol">:</a> <a id="2848" href="Code.html#2741" class="Bound">Γ</a> <a id="2850" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2852" href="Code.html#193" class="InductiveConstructor">★</a> <a id="2854" class="InductiveConstructor Operator">⇒</a> <a id="2856" href="Code.html#193" class="InductiveConstructor">★</a><a id="2857" class="Symbol">)</a>
      <a id="2865" class="Symbol">(</a><a id="2866" href="Code.html#2866" class="Bound">x</a> <a id="2868" class="Symbol">:</a> <a id="2870" href="Code.html#2741" class="Bound">Γ</a> <a id="2872" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2874" class="InductiveConstructor">′ℕ</a><a id="2876" class="Symbol">)</a> <a id="2878" class="Symbol">→</a>
      <a id="2886" class="Comment">------------------------------------</a>
      <a id="2929" class="Symbol">(</a><a id="2930" href="Code.html#2753" class="Bound">materialize</a> <a id="2942" href="Code.html#2676" class="Function">ℕ⇒ℕ≤★⇒★</a> <a id="2950" href="Code.html#2844" class="Bound">f</a><a id="2951" class="Symbol">)</a> <a id="2953" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="2955" href="Code.html#2866" class="Bound">x</a>  <a id="2958" class="Comment">-- : ′ℕ</a>
</pre>
            </code>
          </section>
          <section>
            <div class="left">Cast calculus, intrinsically typed <code>M : Γ ⊢ A</code>:</div>
            <code>
              
<pre class="Agda">  <a id="2051" class="Keyword">data</a> <a id="T._⊢_"></a><a id="2056" href="Code.html#2056" class="Datatype Operator">_⊢_</a> <a id="2060" class="Symbol">:</a> <a id="2062" href="Code.html#1070" class="Datatype">Context</a> <a id="2070" class="Symbol">→</a> <a id="2072" href="Code.html#172" class="Datatype">Type</a> <a id="2077" class="Symbol">→</a> <a id="2079" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2083" class="Keyword">where</a>

    <a id="T._⊢_._·_"></a><a id="2094" href="Code.html#2094" class="InductiveConstructor Operator">_·_</a> <a id="2098" class="Symbol">:</a>
         <a id="2109" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2111" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2113" href="Code.html#269" class="Generalizable">A</a> <a id="2115" class="InductiveConstructor Operator">⇒</a> <a id="2117" href="Code.html#274" class="Generalizable">B</a>
      <a id="2125" class="Symbol">→</a>  <a id="2128" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2130" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2132" href="Code.html#269" class="Generalizable">A</a>
         <a id="2143" class="Comment">--------- application</a>
      <a id="2171" class="Symbol">→</a>  <a id="2174" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2176" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2178" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._⊢_.ƛ_"></a><a id="2185" href="Code.html#2185" class="InductiveConstructor Operator">ƛ_</a> <a id="2188" class="Symbol">:</a>
         <a id="2199" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2201" href="Code.html#1110" class="InductiveConstructor Operator">▷</a> <a id="2203" href="Code.html#269" class="Generalizable">A</a> <a id="2205" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2207" href="Code.html#274" class="Generalizable">B</a>
         <a id="2218" class="Comment">--------- abstraction</a>
      <a id="2246" class="Symbol">→</a>  <a id="2249" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2251" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2253" href="Code.html#269" class="Generalizable">A</a> <a id="2255" class="InductiveConstructor Operator">⇒</a> <a id="2257" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._⊢_.`_"></a><a id="2264" href="Code.html#2264" class="InductiveConstructor Operator">`_</a> <a id="2267" class="Symbol">:</a>
         <a id="2278" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2280" href="Code.html#1964" class="Datatype Operator">∋</a> <a id="2282" href="Code.html#269" class="Generalizable">A</a>
         <a id="2293" class="Comment">----- variable</a>
      <a id="2314" class="Symbol">→</a>  <a id="2317" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2319" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2321" href="Code.html#269" class="Generalizable">A</a>

    <a id="2328" class="Comment">-- etc.</a>
</pre>
            </code>
          </section>
          <section>
            <div class="left">Cast rule:</div>
            <code>
              
<pre class="Agda">    <a id="T._⊢_.cast"></a><a id="2385" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="2390" class="Symbol">:</a>
         <a id="2401" href="Code.html#269" class="Generalizable">A</a> <a id="2403" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="2406" href="Code.html#274" class="Generalizable">B</a>  <a id="2409" class="Comment">-- New cast construct</a>
      <a id="2437" class="Symbol">→</a>  <a id="2440" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2442" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2444" href="Code.html#269" class="Generalizable">A</a>
         <a id="2455" class="Comment">---------</a>
      <a id="2471" class="Symbol">→</a>  <a id="2474" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2476" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2478" href="Code.html#274" class="Generalizable">B</a>
</pre>
            </code>
            <div class="left fragment">
              <div>Casts = upcasts and downcasts:</div>
              <code>
                
<pre class="Agda">  <a id="1741" class="Keyword">data</a> <a id="T._=&gt;_"></a><a id="1746" href="Code.html#1746" class="Datatype Operator">_=&gt;_</a> <a id="1751" class="Symbol">:</a> <a id="1753" href="Code.html#172" class="Datatype">Type</a> <a id="1758" class="Symbol">→</a> <a id="1760" href="Code.html#172" class="Datatype">Type</a> <a id="1765" class="Symbol">→</a> <a id="1767" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1771" class="Keyword">where</a>
    <a id="T._=&gt;_.+_"></a><a id="1781" href="Code.html#1781" class="InductiveConstructor Operator">+_</a> <a id="1784" class="Symbol">:</a>
         <a id="1795" href="Code.html#269" class="Generalizable">A</a> <a id="1797" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1799" href="Code.html#274" class="Generalizable">B</a>
         <a id="1810" class="Comment">------ upcast</a>
      <a id="1830" class="Symbol">→</a>  <a id="1833" href="Code.html#269" class="Generalizable">A</a> <a id="1835" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="1838" href="Code.html#274" class="Generalizable">B</a>

    <a id="T._=&gt;_.-_"></a><a id="1845" href="Code.html#1845" class="InductiveConstructor Operator">-_</a> <a id="1848" class="Symbol">:</a>
         <a id="1859" href="Code.html#274" class="Generalizable">B</a> <a id="1861" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1863" href="Code.html#269" class="Generalizable">A</a>
         <a id="1874" class="Comment">------ downcast</a>
      <a id="1896" class="Symbol">→</a>  <a id="1899" href="Code.html#269" class="Generalizable">A</a> <a id="1901" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="1904" href="Code.html#274" class="Generalizable">B</a>
</pre>
              </code>
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            Operational Semantics of Cast Calculus
          </section>
          <section>
            <div>Values of type \(\star\): boxes</div>
            <code>
              
<pre class="Agda">    <a id="T._⊢_._⇑_"></a><a id="2529" href="Code.html#2529" class="InductiveConstructor Operator">_⇑_</a> <a id="2533" class="Symbol">:</a>
         <a id="2544" class="Symbol">(</a><a id="2545" href="Code.html#2545" class="Bound">M</a> <a id="2547" class="Symbol">:</a> <a id="2549" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2551" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2553" href="Code.html#279" class="Generalizable">G</a><a id="2554" class="Symbol">)</a>
      <a id="2562" class="Symbol">→</a>  <a id="2565" class="Symbol">(</a><a id="2566" href="Code.html#2566" class="Bound">g</a> <a id="2568" class="Symbol">:</a> <a id="2570" href="Code.html#626" class="Datatype">Ground</a> <a id="2577" href="Code.html#279" class="Generalizable">G</a><a id="2578" class="Symbol">)</a>
         <a id="2589" class="Comment">-------------- box</a>
      <a id="2614" class="Symbol">→</a>  <a id="2617" href="Code.html#1189" class="Generalizable">Γ</a> <a id="2619" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="2621" href="Code.html#193" class="InductiveConstructor">★</a>
</pre>
            </code>
            <div class="fragment">
              <div>Ground type is a "tag"</div>
              <code>
                
<pre class="Agda">  <a id="621" class="Keyword">data</a> <a id="T.Ground"></a><a id="626" href="Code.html#626" class="Datatype">Ground</a> <a id="633" class="Symbol">:</a> <a id="635" href="Code.html#172" class="Datatype">Type</a> <a id="640" class="Symbol">→</a> <a id="642" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="646" class="Keyword">where</a>

    <a id="T.Ground.★⇒★"></a><a id="657" href="Code.html#657" class="InductiveConstructor">★⇒★</a> <a id="661" class="Symbol">:</a> <a id="663" href="Code.html#626" class="Datatype">Ground</a> <a id="670" class="Symbol">(</a><a id="671" href="Code.html#193" class="InductiveConstructor">★</a> <a id="673" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="675" href="Code.html#193" class="InductiveConstructor">★</a><a id="676" class="Symbol">)</a>

    <a id="T.Ground.′ℕ"></a><a id="683" href="Code.html#683" class="InductiveConstructor">′ℕ</a> <a id="686" class="Symbol">:</a> <a id="688" href="Code.html#626" class="Datatype">Ground</a> <a id="695" href="Code.html#235" class="InductiveConstructor">′ℕ</a>
</pre>
              </code>
            </div>
          </section>
          <section>
            <div class="fragment">
              <div class="medium">A more informative encoding of precision/casts</div>
              <code>
                
<pre class="Agda">  <a id="749" class="Keyword">data</a> <a id="T._≤_"></a><a id="754" href="Code.html#754" class="Datatype Operator">_≤_</a> <a id="758" class="Symbol">:</a> <a id="760" href="Code.html#172" class="Datatype">Type</a> <a id="765" class="Symbol">→</a> <a id="767" href="Code.html#172" class="Datatype">Type</a> <a id="772" class="Symbol">→</a> <a id="774" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="778" class="Keyword">where</a>
    <a id="T._≤_._⇑_"></a><a id="788" href="Code.html#788" class="InductiveConstructor Operator">_⇑_</a> <a id="792" class="Symbol">:</a>        <a id="801" class="Comment">-- replaces the rule ≤★ : A ≤ ★</a>
        <a id="841" class="Symbol">(</a><a id="842" href="Code.html#842" class="Bound">p</a> <a id="844" class="Symbol">:</a> <a id="846" href="Code.html#269" class="Generalizable">A</a> <a id="848" href="Code.html#754" class="Datatype Operator">≤</a> <a id="850" href="Code.html#279" class="Generalizable">G</a><a id="851" class="Symbol">)</a>
      <a id="859" class="Symbol">→</a> <a id="861" class="Symbol">(</a><a id="862" href="Code.html#862" class="Bound">g</a> <a id="864" class="Symbol">:</a> <a id="866" href="Code.html#626" class="Datatype">Ground</a> <a id="873" href="Code.html#279" class="Generalizable">G</a><a id="874" class="Symbol">)</a>
        <a id="884" class="Comment">-----</a>
      <a id="896" class="Symbol">→</a> <a id="898" href="Code.html#269" class="Generalizable">A</a> <a id="900" href="Code.html#754" class="Datatype Operator">≤</a> <a id="902" href="Code.html#193" class="InductiveConstructor">★</a>

    <a id="T._≤_.id"></a><a id="909" href="Code.html#909" class="InductiveConstructor">id</a> <a id="912" class="Symbol">:</a>
        <a id="922" class="Comment">-----</a>
        <a id="936" href="Code.html#269" class="Generalizable">A</a> <a id="938" href="Code.html#754" class="Datatype Operator">≤</a> <a id="940" href="Code.html#269" class="Generalizable">A</a>

    <a id="T._≤_._⇒_"></a><a id="947" href="Code.html#947" class="InductiveConstructor Operator">_⇒_</a> <a id="951" class="Symbol">:</a>
        <a id="961" href="Code.html#269" class="Generalizable">A</a> <a id="963" href="Code.html#754" class="Datatype Operator">≤</a> <a id="965" href="Code.html#271" class="Generalizable">A′</a>
      <a id="974" class="Symbol">→</a> <a id="976" href="Code.html#274" class="Generalizable">B</a> <a id="978" href="Code.html#754" class="Datatype Operator">≤</a> <a id="980" href="Code.html#276" class="Generalizable">B′</a>
        <a id="991" class="Comment">-------------------</a>
      <a id="1017" class="Symbol">→</a> <a id="1019" class="Symbol">(</a><a id="1020" href="Code.html#269" class="Generalizable">A</a> <a id="1022" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="1024" href="Code.html#274" class="Generalizable">B</a><a id="1025" class="Symbol">)</a> <a id="1027" href="Code.html#754" class="Datatype Operator">≤</a> <a id="1029" class="Symbol">(</a><a id="1030" href="Code.html#271" class="Generalizable">A′</a> <a id="1033" href="Code.html#206" class="InductiveConstructor Operator">⇒</a> <a id="1035" href="Code.html#276" class="Generalizable">B′</a><a id="1037" class="Symbol">)</a>
</pre>
              </code>
            </div>
          </section>
          <section>
            <div>Operational semantics of boxes <code>V ⇑ g</code></div>
            <code>
              
<pre class="Agda">  <a id="3309" class="Keyword">data</a> <a id="T._↦_"></a><a id="3314" href="Code.html#3314" class="Datatype Operator">_↦_</a> <a id="3318" class="Symbol">:</a> <a id="3320" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3322" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3324" href="Code.html#269" class="Generalizable">A</a> <a id="3326" class="Symbol">→</a> <a id="3328" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3330" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3332" href="Code.html#269" class="Generalizable">A</a> <a id="3334" class="Symbol">→</a> <a id="3336" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3340" class="Keyword">where</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.expand"></a><a id="3393" href="Code.html#3393" class="InductiveConstructor">expand</a> <a id="3400" class="Symbol">:</a> <a id="3402" class="Symbol">∀</a> <a id="3404" class="Symbol">{</a><a id="3405" href="Code.html#3405" class="Bound">V</a> <a id="3407" class="Symbol">:</a> <a id="3409" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3411" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3413" href="Code.html#269" class="Generalizable">A</a><a id="3414" class="Symbol">}</a> <a id="3416" class="Symbol">{</a><a id="3417" href="Code.html#3417" class="Bound">p</a> <a id="3419" class="Symbol">:</a> <a id="3421" href="Code.html#269" class="Generalizable">A</a> <a id="3423" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3425" href="Code.html#279" class="Generalizable">G</a><a id="3426" class="Symbol">}</a>
      <a id="3434" class="Symbol">→</a> <a id="3436" href="Code.html#3063" class="Datatype">Value</a> <a id="3442" href="Code.html#3405" class="Bound">V</a>
      <a id="3450" class="Symbol">→</a> <a id="3452" class="Symbol">(</a><a id="3453" href="Code.html#3453" class="Bound">g</a> <a id="3455" class="Symbol">:</a> <a id="3457" href="Code.html#626" class="Datatype">Ground</a> <a id="3464" href="Code.html#279" class="Generalizable">G</a><a id="3465" class="Symbol">)</a>
        <a id="3475" class="Comment">-------------------------------------</a>
      <a id="3519" class="Symbol">→</a> <a id="3521" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3526" class="Symbol">(</a><a id="3527" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="3529" class="Symbol">(</a><a id="3530" href="Code.html#3417" class="Bound">p</a> <a id="3532" class="InductiveConstructor Operator">⇑</a> <a id="3534" href="Code.html#3453" class="Bound">g</a><a id="3535" class="Symbol">))</a> <a id="3538" href="Code.html#3405" class="Bound">V</a> <a id="3540" href="Code.html#3314" class="Datatype Operator">↦</a> <a id="3542" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3547" class="Symbol">(</a><a id="3548" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="3550" href="Code.html#3417" class="Bound">p</a><a id="3551" class="Symbol">)</a> <a id="3553" href="Code.html#3405" class="Bound">V</a> <a id="3555" class="InductiveConstructor Operator">⇑</a> <a id="3557" href="Code.html#3453" class="Bound">g</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.collapse"></a><a id="3606" href="Code.html#3606" class="InductiveConstructor">collapse</a> <a id="3615" class="Symbol">:</a> <a id="3617" class="Symbol">∀</a> <a id="3619" class="Symbol">{</a><a id="3620" href="Code.html#3620" class="Bound">V</a> <a id="3622" class="Symbol">:</a> <a id="3624" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3626" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3628" href="Code.html#279" class="Generalizable">G</a><a id="3629" class="Symbol">}</a> <a id="3631" class="Symbol">{</a><a id="3632" href="Code.html#3632" class="Bound">p</a> <a id="3634" class="Symbol">:</a> <a id="3636" href="Code.html#269" class="Generalizable">A</a> <a id="3638" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3640" href="Code.html#279" class="Generalizable">G</a><a id="3641" class="Symbol">}</a>
      <a id="3649" class="Symbol">→</a> <a id="3651" href="Code.html#3063" class="Datatype">Value</a> <a id="3657" href="Code.html#3620" class="Bound">V</a>
      <a id="3665" class="Symbol">→</a> <a id="3667" class="Symbol">(</a><a id="3668" href="Code.html#3668" class="Bound">g</a> <a id="3670" class="Symbol">:</a> <a id="3672" href="Code.html#626" class="Datatype">Ground</a> <a id="3679" href="Code.html#279" class="Generalizable">G</a><a id="3680" class="Symbol">)</a>
        <a id="3690" class="Comment">---------------------------------------</a>
      <a id="3736" class="Symbol">→</a> <a id="3738" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3743" class="Symbol">(</a><a id="3744" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3746" class="Symbol">(</a><a id="3747" href="Code.html#3632" class="Bound">p</a> <a id="3749" class="InductiveConstructor Operator">⇑</a> <a id="3751" href="Code.html#3668" class="Bound">g</a><a id="3752" class="Symbol">))</a> <a id="3755" class="Symbol">(</a><a id="3756" href="Code.html#3620" class="Bound">V</a> <a id="3758" class="InductiveConstructor Operator">⇑</a> <a id="3760" href="Code.html#3668" class="Bound">g</a><a id="3761" class="Symbol">)</a> <a id="3763" href="Code.html#3314" class="Datatype Operator">↦</a> <a id="3765" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3770" class="Symbol">(</a><a id="3771" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3773" href="Code.html#3632" class="Bound">p</a><a id="3774" class="Symbol">)</a> <a id="3776" href="Code.html#3620" class="Bound">V</a>
</pre>
            </code>
            <code class="fragment">
              
<pre class="Agda">    <a id="T._↦_.collide"></a><a id="3825" href="Code.html#3825" class="InductiveConstructor">collide</a>  <a id="3834" class="Symbol">:</a> <a id="3836" class="Symbol">∀</a> <a id="3838" class="Symbol">{</a><a id="3839" href="Code.html#3839" class="Bound">V</a> <a id="3841" class="Symbol">:</a> <a id="3843" href="Code.html#1189" class="Generalizable">Γ</a> <a id="3845" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="3847" href="Code.html#279" class="Generalizable">G</a><a id="3848" class="Symbol">}</a> <a id="3850" class="Symbol">{</a><a id="3851" href="Code.html#3851" class="Bound">p</a> <a id="3853" class="Symbol">:</a> <a id="3855" href="Code.html#269" class="Generalizable">A</a> <a id="3857" href="Code.html#754" class="Datatype Operator">≤</a> <a id="3859" href="Code.html#281" class="Generalizable">H</a><a id="3860" class="Symbol">}</a>
      <a id="3868" class="Symbol">→</a> <a id="3870" href="Code.html#3063" class="Datatype">Value</a> <a id="3876" href="Code.html#3839" class="Bound">V</a>
      <a id="3884" class="Symbol">→</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Code.html#3887" class="Bound">g</a> <a id="3889" class="Symbol">:</a> <a id="3891" href="Code.html#626" class="Datatype">Ground</a> <a id="3898" href="Code.html#279" class="Generalizable">G</a><a id="3899" class="Symbol">)</a>
      <a id="3907" class="Symbol">→</a> <a id="3909" class="Symbol">(</a><a id="3910" href="Code.html#3910" class="Bound">h</a> <a id="3912" class="Symbol">:</a> <a id="3914" href="Code.html#626" class="Datatype">Ground</a> <a id="3921" href="Code.html#281" class="Generalizable">H</a><a id="3922" class="Symbol">)</a>
      <a id="3930" class="Symbol">→</a> <a id="3932" href="Code.html#279" class="Generalizable">G</a> <a id="3934" href="Relation.Binary.PropositionalEquality.Core.html#839" class="Function Operator">≢</a> <a id="3936" href="Code.html#281" class="Generalizable">H</a>
        <a id="3946" class="Comment">--------------------------------</a>
      <a id="3985" class="Symbol">→</a> <a id="3987" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="3992" class="Symbol">(</a><a id="3993" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="3995" class="Symbol">(</a><a id="3996" href="Code.html#3851" class="Bound">p</a> <a id="3998" class="InductiveConstructor Operator">⇑</a> <a id="4000" href="Code.html#3910" class="Bound">h</a><a id="4001" class="Symbol">))</a> <a id="4004" class="Symbol">(</a><a id="4005" href="Code.html#3839" class="Bound">V</a> <a id="4007" class="InductiveConstructor Operator">⇑</a> <a id="4009" href="Code.html#3887" class="Bound">g</a><a id="4010" class="Symbol">)</a> <a id="4012" href="Code.html#3314" class="Datatype Operator">↦</a> <a id="4014" href="Code.html#2651" class="InductiveConstructor">blame</a>
</pre>
            </code>
          </section>
          <section>
            <div>Operational semantics of function casts <code>(∓s ⇒ ±t)</code></div>
            <code>
              
<pre class="Agda">    <a id="T._↦_.wrap"></a><a id="4065" href="Code.html#4065" class="InductiveConstructor">wrap</a> <a id="4070" class="Symbol">:</a> <a id="4072" class="Symbol">∀</a> <a id="4074" class="Symbol">{</a><a id="4075" href="Code.html#4075" class="Bound">N</a> <a id="4077" class="Symbol">:</a> <a id="4079" href="Code.html#1189" class="Generalizable">Γ</a> <a id="4081" href="Code.html#1110" class="InductiveConstructor Operator">▷</a> <a id="4083" href="Code.html#269" class="Generalizable">A</a> <a id="4085" href="Code.html#2056" class="Datatype Operator">⊢</a> <a id="4087" href="Code.html#274" class="Generalizable">B</a><a id="4088" class="Symbol">}</a>
        <a id="4098" class="Symbol">{</a><a id="4099" href="Code.html#4099" class="Bound">∓s</a> <a id="4102" class="Symbol">:</a> <a id="4104" href="Code.html#271" class="Generalizable">A′</a> <a id="4107" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4110" href="Code.html#269" class="Generalizable">A</a><a id="4111" class="Symbol">}</a> <a id="4113" class="Symbol">{</a><a id="4114" href="Code.html#4114" class="Bound">±t</a> <a id="4117" class="Symbol">:</a> <a id="4119" href="Code.html#274" class="Generalizable">B</a> <a id="4121" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4124" href="Code.html#276" class="Generalizable">B′</a><a id="4126" class="Symbol">}</a> <a id="4128" class="Symbol">{</a><a id="4129" href="Code.html#4129" class="Bound">±p</a> <a id="4132" class="Symbol">:</a> <a id="4134" href="Code.html#269" class="Generalizable">A</a> <a id="4136" class="InductiveConstructor Operator">⇒</a> <a id="4138" href="Code.html#274" class="Generalizable">B</a> <a id="4140" href="Code.html#1746" class="Datatype Operator">=&gt;</a> <a id="4143" href="Code.html#271" class="Generalizable">A′</a> <a id="4146" class="InductiveConstructor Operator">⇒</a> <a id="4148" href="Code.html#276" class="Generalizable">B′</a><a id="4150" class="Symbol">}</a>
      <a id="4158" class="Symbol">→</a> <a id="4160" href="Code.html#3212" class="Function">split</a> <a id="4166" href="Code.html#4129" class="Bound">±p</a> <a id="4169" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4171" href="Code.html#4099" class="Bound">∓s</a> <a id="4174" class="InductiveConstructor Operator">⇒</a> <a id="4176" href="Code.html#4114" class="Bound">±t</a>
        <a id="4187" class="Comment">----------------------------------------------------</a>
      <a id="4246" class="Symbol">→</a> <a id="4248" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4253" href="Code.html#4129" class="Bound">±p</a> <a id="4256" class="Symbol">(</a><a id="4257" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4259" href="Code.html#4075" class="Bound">N</a><a id="4260" class="Symbol">)</a> <a id="4262" href="Code.html#3314" class="Datatype Operator">↦</a> <a id="4264" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4266" class="Symbol">(</a><a id="4267" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4272" href="Code.html#4114" class="Bound">±t</a> <a id="4275" class="Symbol">(</a><a id="4276" href="Code.html#3007" class="Function">lift</a> <a id="4281" class="Symbol">(</a><a id="4282" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4284" href="Code.html#4075" class="Bound">N</a><a id="4285" class="Symbol">)</a> <a id="4287" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="4289" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4294" href="Code.html#4099" class="Bound">∓s</a> <a id="4297" class="Symbol">(</a><a id="4298" href="Code.html#2264" class="InductiveConstructor Operator">`</a> <a id="4300" href="Code.html#2001" class="InductiveConstructor">Z</a><a id="4301" class="Symbol">)))</a>
</pre>
            </code>
            <div>Rewritten with variable names:<br>
              <code class="medium-small">cast (∓s ⇒ ±t) f  ↦  λ x. cast ±t (f (cast ∓s x)) </code></div>
          </section>
          <section>
            <div>Progress <span class="strike">and preservation</span></div>
            <div class="flexbox">
            <code class="flex-2">
              
<pre class="Agda">  <a id="5322" class="Keyword">data</a> <a id="W.Progress"></a><a id="5327" href="Code.html#5327" class="Datatype">Progress</a> <a id="5336" class="Symbol">:</a> <a id="5338" class="Symbol">(</a><a id="5339" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5341" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5343" href="Code.html#5280" class="Generalizable">A</a><a id="5344" class="Symbol">)</a> <a id="5346" class="Symbol">→</a> <a id="5348" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="5352" class="Keyword">where</a>

    <a id="W.Progress.step"></a><a id="5363" href="Code.html#5363" class="InductiveConstructor">step</a> <a id="5368" class="Symbol">:</a> <a id="5370" class="Symbol">∀</a> <a id="5372" class="Symbol">{</a><a id="5373" href="Code.html#5373" class="Bound">M</a> <a id="5375" href="Code.html#5375" class="Bound">N</a> <a id="5377" class="Symbol">:</a> <a id="5379" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5381" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5383" href="Code.html#5280" class="Generalizable">A</a><a id="5384" class="Symbol">}</a>
      <a id="5392" class="Symbol">→</a>  <a id="5395" href="Code.html#5373" class="Bound">M</a> <a id="5397" href="Progress.html#15477" class="Datatype Operator">—→</a> <a id="5400" href="Code.html#5375" class="Bound">N</a>
         <a id="5411" class="Comment">----------</a>
      <a id="5428" class="Symbol">→</a>  <a id="5431" href="Code.html#5327" class="Datatype">Progress</a> <a id="5440" href="Code.html#5373" class="Bound">M</a>

    <a id="W.Progress.done"></a><a id="5447" href="Code.html#5447" class="InductiveConstructor">done</a> <a id="5452" class="Symbol">:</a> <a id="5454" class="Symbol">∀</a> <a id="5456" class="Symbol">{</a><a id="5457" href="Code.html#5457" class="Bound">M</a> <a id="5459" class="Symbol">:</a> <a id="5461" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5463" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5465" href="Code.html#5280" class="Generalizable">A</a><a id="5466" class="Symbol">}</a>
      <a id="5474" class="Symbol">→</a>  <a id="5477" href="Core.html#22063" class="Datatype">Value</a> <a id="5483" href="Code.html#5457" class="Bound">M</a>
         <a id="5494" class="Comment">----------</a>
      <a id="5511" class="Symbol">→</a>  <a id="5514" href="Code.html#5327" class="Datatype">Progress</a> <a id="5523" href="Code.html#5457" class="Bound">M</a>

    <a id="W.Progress.blame"></a><a id="5530" href="Code.html#5530" class="InductiveConstructor">blame</a> <a id="5536" class="Symbol">:</a> <a id="5538" class="Symbol">∀</a> <a id="5540" class="Symbol">{</a><a id="5541" href="Code.html#5541" class="Bound">Q</a><a id="5542" class="Symbol">}</a>
      <a id="5550" class="Symbol">→</a>  <a id="5553" class="Symbol">(</a><a id="5554" href="Code.html#5554" class="Bound">E</a> <a id="5556" class="Symbol">:</a> <a id="5558" href="Progress.html#904" class="Datatype">Frame</a> <a id="5564" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5566" href="Code.html#5541" class="Bound">Q</a> <a id="5568" href="Code.html#5280" class="Generalizable">A</a><a id="5569" class="Symbol">)</a>
         <a id="5580" class="Comment">---------------------</a>
      <a id="5608" class="Symbol">→</a>  <a id="5611" href="Code.html#5327" class="Datatype">Progress</a> <a id="5620" class="Symbol">(</a><a id="5621" href="Code.html#5554" class="Bound">E</a> <a id="5623" href="Progress.html#2827" class="Function Operator">⟦</a> <a id="5625" href="Core.html#4129" class="InductiveConstructor">blame</a> <a id="5631" href="Progress.html#2827" class="Function Operator">⟧</a><a id="5632" class="Symbol">)</a>
</pre>
            </code>
            <code class="fragment flex-1">
              
<pre class="Agda">  <a id="5682" class="Comment">-- Theorem</a>
  <a id="W.progress"></a><a id="5695" href="Code.html#5695" class="Function">progress</a> <a id="5704" class="Symbol">:</a>
      <a id="5712" class="Symbol">(</a><a id="5713" href="Code.html#5713" class="Bound">M</a> <a id="5715" class="Symbol">:</a> <a id="5717" href="Core.html#372" class="InductiveConstructor">∅</a> <a id="5719" href="Core.html#1038" class="Datatype Operator">⊢</a> <a id="5721" href="Code.html#5280" class="Generalizable">A</a><a id="5722" class="Symbol">)</a>
      <a id="5730" class="Comment">-----------</a>
    <a id="5746" class="Symbol">→</a> <a id="5748" href="Code.html#5327" class="Datatype">Progress</a> <a id="5757" href="Code.html#5713" class="Bound">M</a>
  <a id="5761" href="Code.html#5695" class="Function">progress</a> <a id="5770" class="Symbol">=</a> <a id="5772" href="Code.html#120" class="Postulate">todo</a>
</pre>
            </code>
            </div>
            <div class="fragment">Progress proof \(\overset{\text{Curry-Howard}}{=}\) Interpreter</div>
          </section>
          <section>
            <div class="medium-small">Example: how to box <code>f : nat → nat</code> in \(\star\)</div>
            <div>
              <code class="fragment">
                
<pre class="Agda">          <a id="4491" href="Code.html#4491" class="Bound">M</a> <a id="4493" class="Symbol">=</a> <a id="4495" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4500" class="Symbol">(</a><a id="4501" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4503" class="Symbol">((</a><a id="4505" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4508" class="InductiveConstructor Operator">⇑</a> <a id="4510" class="InductiveConstructor">′ℕ</a><a id="4512" class="Symbol">)</a> <a id="4514" class="InductiveConstructor Operator">⇒</a> <a id="4516" class="Symbol">(</a><a id="4517" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4520" class="InductiveConstructor Operator">⇑</a> <a id="4522" class="InductiveConstructor">′ℕ</a><a id="4524" class="Symbol">))</a> <a id="4527" class="InductiveConstructor Operator">⇑</a> <a id="4529" href="Code.html#657" class="InductiveConstructor">★⇒★</a><a id="4532" class="Symbol">)</a> <a id="4534" href="Code.html#4436" class="Bound">f</a>
</pre>
              </code>
              <code class="fragment">
                
<pre class="Agda">            <a id="4626" class="Comment">-- by expand</a>
            <a id="4651" href="Code.html#3314" class="Datatype Operator">↦</a>  <a id="4654" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4659" class="Symbol">(</a><a id="4660" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4662" class="Symbol">((</a><a id="4664" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4667" class="InductiveConstructor Operator">⇑</a> <a id="4669" class="InductiveConstructor">′ℕ</a><a id="4671" class="Symbol">)</a> <a id="4673" class="InductiveConstructor Operator">⇒</a> <a id="4675" class="Symbol">(</a><a id="4676" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4679" class="InductiveConstructor Operator">⇑</a> <a id="4681" class="InductiveConstructor">′ℕ</a><a id="4683" class="Symbol">)))</a> <a id="4687" href="Code.html#4436" class="Bound">f</a> <a id="4689" class="InductiveConstructor Operator">⇑</a> <a id="4691" href="Code.html#657" class="InductiveConstructor">★⇒★</a>
</pre>
              </code>
              <code class="fragment">
                
<pre class="Agda">            <a id="4785" class="Comment">-- by wrap</a>
            <a id="4808" href="Code.html#3314" class="Datatype Operator">↦</a>  <a id="4811" class="Symbol">(</a><a id="4812" href="Code.html#2185" class="InductiveConstructor Operator">ƛ</a> <a id="4814" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4819" class="Symbol">(</a><a id="4820" href="Code.html#1781" class="InductiveConstructor Operator">+</a> <a id="4822" class="Symbol">(</a><a id="4823" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4826" class="InductiveConstructor Operator">⇑</a> <a id="4828" class="InductiveConstructor">′ℕ</a><a id="4830" class="Symbol">))</a>
                        <a id="4857" class="Symbol">(</a> <a id="4859" href="Code.html#3007" class="Function">lift</a> <a id="4864" href="Code.html#4436" class="Bound">f</a>
                        <a id="4890" href="Code.html#2094" class="InductiveConstructor Operator">·</a> <a id="4892" href="Code.html#2385" class="InductiveConstructor">cast</a> <a id="4897" class="Symbol">(</a><a id="4898" href="Code.html#1845" class="InductiveConstructor Operator">-</a> <a id="4900" class="Symbol">(</a><a id="4901" href="Code.html#909" class="InductiveConstructor">id</a> <a id="4904" class="InductiveConstructor Operator">⇑</a> <a id="4906" class="InductiveConstructor">′ℕ</a><a id="4908" class="Symbol">))</a> <a id="4911" class="Symbol">(</a><a id="4912" href="Code.html#2264" class="InductiveConstructor Operator">`</a> <a id="4914" href="Code.html#2001" class="InductiveConstructor">Z</a><a id="4915" class="Symbol">)))</a>  <a id="4920" class="InductiveConstructor Operator">⇑</a> <a id="4922" href="Code.html#657" class="InductiveConstructor">★⇒★</a>
            <a id="4938" class="Comment">--  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</a>
            <a id="4998" class="Comment">--  Value ((ƛ _) ⇑ ★⇒★)</a>
</pre>
              </code>
            </div>
          </section>
        </section>
        <section>
				  <section data-background-gradient="conic-gradient(at 50% 35%, #F0F1EB, #61584D)">
            The Gradual Guarantee
          </section>
          <section>
            <div class="medium">Starting from a statically typed program (no \(\star\)), removing type annotations
              \(\importanttypecolor{\text{cannot change}}\) its behavior in any way.</div>
            <div><img class="col-2" src="graduality-1-tex.svg" width="250" height="250"/></div>

          </section>
          <section>
            <div class="medium">If you add more type annotations to a program, then you may cause a \(\castcolor{\text{type error}}\), but otherwise \(\importanttypecolor{\text{no change}}\) to the value of a program.</div>
            <div><img class="col-2" src="graduality-2-tex.svg" width="250" height="250"/></div>

          </section>
          <section>
            <style>
              .container { display: flex; align-items: center; }
              .col-1 { flex: 2; } .col-2 { flex: 1; }
            </style>
            <div class="container">
              <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁺≤"></a><a id="6171" href="Code.html#6171" class="Function">cast⁺≤</a> <a id="6178" class="Symbol">:</a> <a id="6180" class="Symbol">{</a><a id="6181" href="Code.html#6181" class="Bound">p</a> <a id="6183" class="Symbol">:</a> <a id="6185" href="Code.html#6015" class="Generalizable">P</a> <a id="6187" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6190" href="Code.html#6020" class="Generalizable">Q</a><a id="6191" class="Symbol">}</a> <a id="6193" class="Symbol">{</a><a id="6194" href="Code.html#6194" class="Bound">q</a> <a id="6196" class="Symbol">:</a> <a id="6198" href="Code.html#6020" class="Generalizable">Q</a> <a id="6200" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6203" href="Code.html#6022" class="Generalizable">R</a><a id="6204" class="Symbol">}</a> <a id="6206" class="Symbol">{</a><a id="6207" href="Code.html#6207" class="Bound">r</a> <a id="6209" class="Symbol">:</a> <a id="6211" href="Code.html#6015" class="Generalizable">P</a> <a id="6213" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6216" href="Code.html#6022" class="Generalizable">R</a><a id="6217" class="Symbol">}</a>
    <a id="6223" class="Symbol">→</a>  <a id="6226" href="Code.html#6181" class="Bound">p</a> <a id="6228" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="6231" href="Code.html#6194" class="Bound">q</a> <a id="6233" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6235" href="Code.html#6207" class="Bound">r</a>       <a id="6243" class="Comment">-- ← commutative triangle</a>
    <a id="6273" class="Symbol">→</a>  <a id="6276" href="Code.html#6051" class="Generalizable">Γ≤</a> <a id="6279" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6281" href="Code.html#6092" class="Generalizable">M</a> <a id="6283" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6286" href="Code.html#6104" class="Generalizable">M′</a> <a id="6289" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6291" href="Code.html#6207" class="Bound">r</a>
       <a id="6300" class="Comment">---------------------------</a>
    <a id="6332" class="Symbol">→</a>  <a id="6335" href="Code.html#6051" class="Generalizable">Γ≤</a> <a id="6338" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6340" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="6345" class="Symbol">(</a><a id="6346" href="Type.html#15288" class="InductiveConstructor Operator">+</a> <a id="6348" href="Code.html#6181" class="Bound">p</a><a id="6349" class="Symbol">)</a> <a id="6351" href="Code.html#6092" class="Generalizable">M</a> <a id="6353" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6356" href="Code.html#6104" class="Generalizable">M′</a> <a id="6359" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6361" href="Code.html#6194" class="Bound">q</a>
</pre></code>
              <img class="col-2" src="cast-left-plus-tex.svg" width="250" height="250"/>
            </div>
            <div class="container">
              <code class="col-1 tiny">
<pre class="Agda">  <a id="B.cast⁻≤"></a><a id="6442" href="Code.html#6442" class="Function">cast⁻≤</a> <a id="6449" class="Symbol">:</a> <a id="6451" class="Symbol">{</a><a id="6452" href="Code.html#6452" class="Bound">p</a> <a id="6454" class="Symbol">:</a> <a id="6456" href="Code.html#6020" class="Generalizable">Q</a> <a id="6458" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6461" href="Code.html#6015" class="Generalizable">P</a><a id="6462" class="Symbol">}</a> <a id="6464" class="Symbol">{</a><a id="6465" href="Code.html#6465" class="Bound">q</a> <a id="6467" class="Symbol">:</a> <a id="6469" href="Code.html#6020" class="Generalizable">Q</a> <a id="6471" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6474" href="Code.html#6022" class="Generalizable">R</a><a id="6475" class="Symbol">}</a> <a id="6477" class="Symbol">{</a><a id="6478" href="Code.html#6478" class="Bound">r</a> <a id="6480" class="Symbol">:</a> <a id="6482" href="Code.html#6015" class="Generalizable">P</a> <a id="6484" href="Type.html#7693" class="Record Operator">≤ᶜ</a> <a id="6487" href="Code.html#6022" class="Generalizable">R</a><a id="6488" class="Symbol">}</a>
    <a id="6494" class="Symbol">→</a>  <a id="6497" href="Code.html#6452" class="Bound">p</a> <a id="6499" href="Type.html#11340" class="Function Operator">⨟ᶜ</a> <a id="6502" href="Code.html#6478" class="Bound">r</a> <a id="6504" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6506" href="Code.html#6465" class="Bound">q</a>       <a id="6514" class="Comment">-- ← commutative triangle</a>
    <a id="6544" class="Symbol">→</a>  <a id="6547" href="Code.html#6051" class="Generalizable">Γ≤</a> <a id="6550" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6552" href="Code.html#6092" class="Generalizable">M</a> <a id="6554" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6557" href="Code.html#6104" class="Generalizable">M′</a> <a id="6560" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6562" href="Code.html#6478" class="Bound">r</a>
       <a id="6571" class="Comment">--------------------------</a>
    <a id="6602" class="Symbol">→</a>  <a id="6605" href="Code.html#6051" class="Generalizable">Γ≤</a> <a id="6608" href="Prec.html#11589" class="Datatype Operator">⊢</a> <a id="6610" href="Core.html#3688" class="InductiveConstructor">cast</a> <a id="6615" class="Symbol">(</a><a id="6616" href="Type.html#15391" class="InductiveConstructor Operator">-</a> <a id="6618" href="Code.html#6452" class="Bound">p</a><a id="6619" class="Symbol">)</a> <a id="6621" href="Code.html#6092" class="Generalizable">M</a> <a id="6623" href="Prec.html#11589" class="Datatype Operator">≤ᴹ</a> <a id="6626" href="Code.html#6104" class="Generalizable">M′</a> <a id="6629" href="Prec.html#11589" class="Datatype Operator">⦂</a> <a id="6631" href="Code.html#6465" class="Bound">q</a>
</pre></code>
              <img class="col-2" src="cast-left-minus-tex.svg" width="250" height="250"/>
            </div>
          </section>
        </section>


        <section>
          <h3>Ongoing and Future Work</h3>
          <ul>
            <li>Integrate algebraic effects and handlers</li>
            <li>Complete formalization of gradual guarantee
              <ul>
                <li>Done: Simulation proof for the cast calculus</li>
                <li>Todo: Relate back to surface syntax</li>
              </ul>
            </li>
            <li>Odd difficulties with effect subtyping and fine-grained CBV</li>
            <li>Agda. Very fun, very slow.</li>
          </ul>
        </section>
        <section>
          END
        </section>


-->
			</div>
		</div>

		<script src="reveal.js/dist/reveal.js"></script>
		<script src="reveal.js/plugin/notes/notes.js"></script>
		<script src="reveal.js/plugin/markdown/markdown.js"></script>
		<script src="reveal.js/plugin/highlight/highlight.js"></script>
    <script src="reveal.js/plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
        slideNumber: 'c',
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.MathJax3 ],
        mathjax3: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          tex: {
            inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ]  ]
          },
          options: {
            skipHtmlTags: [ 'script', 'noscript', 'style', 'textarea', 'pre' ]
          },
        }
			});
		</script>
	</body>
</html>